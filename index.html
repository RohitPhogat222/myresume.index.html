<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0, user-scalable=yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Avanode Digitals">
  <meta name="theme-color" content="#2d1b4e">
  <title>Avanode | Digital Animation Arts</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
 
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&amp;family=Space+Grotesk:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    /* ... (Styles preserved) ... */
    html, body {
      box-sizing: border-box;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      overscroll-behavior: none;
    }
 
    input, textarea, select {
      -webkit-user-select: text !important;
      user-select: text !important;
    }
     
    * {
      font-family: 'Outfit', sans-serif;
    }
     
    .heading-font {
      font-family: 'Space Grotesk', sans-serif;
    }
     
    .glass {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
    }
     
    .glass-dark {
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
     
   .gradient-bg {
      background-color: #1a1a2e; 
      /* Reduced opacity for visibility */
      background: linear-gradient(rgba(10, 10, 20, 0.5), rgba(26, 26, 46, 0.6)), 
                   url('https://raw.githubusercontent.com/RohitPhogat222/liforawellness.index.html/main/Screenshot%202025-03-07%20193036.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
    }
     
    .blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.5;
      animation: float 8s ease-in-out infinite;
    }
     
    .blob-1 { width: 400px; height: 400px; background: linear-gradient(135deg, #00f2fe, #4facfe); top: -100px; left: -100px; }
    .blob-2 { width: 350px; height: 350px; background: linear-gradient(135deg, #f093fb, #f5576c); bottom: 20%; right: -50px; animation-delay: -4s; }
    .blob-3 { width: 300px; height: 300px; background: linear-gradient(135deg, #a18cd1, #fbc2eb); bottom: -100px; left: 30%; animation-delay: -2s; }
     
    @keyframes float {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(30px, -30px) scale(1.05); }
      66% { transform: translate(-20px, 20px) scale(0.95); }
    }
     
    .animate-float { animation: float 6s ease-in-out infinite; }
    .gallery-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
   .gallery-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 25px 50px -12px rgba(79, 172, 254, 0.4); }
   .gallery-card:active { transform: translateY(-4px) scale(1.01); }
   .gallery-card:hover .card-overlay, .gallery-card:active .card-overlay { opacity: 1; }
   .gallery-card:hover img, .gallery-card:active img { transform: scale(1.1); }
    .card-overlay { opacity: 0; transition: opacity 0.3s ease; }
    .skill-tag { transition: all 0.3s ease; }
    .skill-tag:hover { transform: scale(1.05); background: rgba(255, 255, 255, 0.2); }
    .skill-tag:active { transform: scale(0.98); }
    .upload-zone { border: 2px dashed rgba(255, 255, 255, 0.3); transition: all 0.3s ease; }
    .upload-zone:hover { border-color: rgba(79, 172, 254, 0.8); background: rgba(79, 172, 254, 0.1); }
   .upload-zone:active { border-color: rgba(79, 172, 254, 1); background: rgba(79, 172, 254, 0.2); }
    .pagination-btn { transition: all 0.3s ease; }
   .pagination-btn:hover:not(:disabled) { background: rgba(255, 255, 255, 0.2); transform: scale(1.1); }
   .pagination-btn:active:not(:disabled) { background: rgba(255, 255, 255, 0.25); transform: scale(0.95); }
   .pagination-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .search-input { transition: all 0.3s ease; }
   .search-input:focus { box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.3); }
    .fade-in { animation: fadeIn 0.5s ease forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
     
   ::-webkit-scrollbar { width: 8px; }
   ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
   ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 4px; }
   ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.3); }
 
    .tab-btn { transition: all 0.3s ease; }
    .tab-btn.active { background: rgba(255, 255, 255, 0.2); border-bottom: 2px solid rgba(79, 172, 254, 0.8); }
    .input-field { transition: all 0.3s ease; -webkit-appearance: none; appearance: none; font-size: 16px; }
    .input-field:focus { box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2); }
    .success-toast { animation: slideIn 0.3s ease forwards; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .modal-backdrop { animation: fadeInBg 0.3s ease forwards; }
    @keyframes fadeInBg { from { opacity: 0; } to { opacity: 1; } }
    .modal-content { animation: scaleIn 0.3s ease forwards; }
    @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    .slide-left { animation: slideLeft 0.4s ease forwards; }
    @keyframes slideLeft { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(-30px); } }
    .slide-right { animation: slideRight 0.4s ease forwards; }
    @keyframes slideRight { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
     
    /* NEW ANIMATIONS FOR SETTINGS DRAWER */
    .slide-down { animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    @keyframes slideDown { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    @keyframes slideUp { from { transform: translateY(0); opacity: 1; } to { transform: translateY(-100%); opacity: 0; } }
 
    .error-message { color: #f87171; font-size: 0.875rem; margin-top: 0.5rem; }
    .form-group { margin-bottom: 1.5rem; }
    .verification-code { font-family: 'Space Grotesk', monospace; letter-spacing: 0.25rem; font-size: 1.25rem; font-weight: bold; }
    .info-banner { background: rgba(79, 172, 254, 0.1); border-left: 4px solid rgba(79, 172, 254, 0.8); animation: slideIn 0.5s ease forwards; }
    .online-bar { position: static; height: auto; background: rgba(79, 172, 254, 0.1); border-top: 1px solid rgba(79, 172, 254, 0.3); display: flex; align-items: center; justify-content: center; gap: 12px; animation: fadeIn 0.5s ease-out; padding: 16px; margin-top: 24px; }
    .online-indicator { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: rgba(255, 255, 255, 0.05); border-radius: 20px; border: 1px solid rgba(79, 172, 254, 0.3); }
    .online-dot { width: 8px; height: 8px; background: #00f2fe; border-radius: 50%; animation: pulse 2s ease-in-out infinite; flex-shrink: 0; }
    @keyframes pulse { 0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(0, 242, 254, 0.7); } 50% { opacity: 1; box-shadow: 0 0 0 6px rgba(0, 242, 254, 0.1); } }
    .online-text { font-size: 0.875rem; color: #fff; font-weight: 500; white-space: nowrap; }
    .online-count { font-weight: 700; background: linear-gradient(135deg, #00f2fe, #4facfe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    @supports (padding: max(0px)) { header { padding-top: max(0px, env(safe-area-inset-top)); } }
    button { min-height: 44px; min-width: 44px; }
    #mascot-container { width: 250px; height: 250px; margin: 0 auto 2rem auto; border-radius: 50%; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.5); background: linear-gradient(135deg, rgba(20, 30, 48, 0.8), rgba(36, 59, 85, 0.8)); border: 2px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
    #mascot-container canvas { display: block; outline: none; }
    @media (max-width: 768px) {
      .blob { filter: blur(60px); }
      .blob-1 { width: 300px; height: 300px; top: -80px; left: -80px; }
      .blob-2 { width: 250px; height: 250px; right: -40px; }
      .blob-3 { width: 200px; height: 200px; }
     #mascot-container { width: 200px; height: 200px; }
    }
    
    /* Custom Scrollbar for Chat */
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 3px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.2); }
    
    /* Menu Backdrop Effect */
    #menu-backdrop {
        transition: opacity 0.4s ease, backdrop-filter 0.4s ease;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }
    
    /* --- LIGHT MODE OVERRIDES --- */
    body.light-mode {
      background-color: #f3f4f6;
      /* Light gradient overlay */
      background: linear-gradient(rgba(240, 242, 245, 0.85), rgba(240, 242, 245, 0.9)), 
                   url('https://raw.githubusercontent.com/RohitPhogat222/liforawellness.index.html/main/Screenshot%202025-03-07%20193036.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: #111827; /* Gray 900 */
    }

    /* Invert Glass Effects for Light Mode */
    body.light-mode .glass {
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(0, 0, 0, 0.05);
      backdrop-filter: blur(20px);
    }

    body.light-mode .glass-dark {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.05);
      color: #111827;
    }

    /* Text Color Inversions */
    body.light-mode .text-white { color: #111827 !important; }
    body.light-mode .text-white\/90 { color: rgba(17, 24, 39, 0.9) !important; }
    body.light-mode .text-white\/80 { color: rgba(17, 24, 39, 0.8) !important; }
    body.light-mode .text-white\/70 { color: rgba(17, 24, 39, 0.7) !important; }
    body.light-mode .text-white\/60 { color: rgba(17, 24, 39, 0.6) !important; }
    body.light-mode .text-white\/50 { color: rgba(17, 24, 39, 0.5) !important; }
    body.light-mode .text-white\/40 { color: rgba(17, 24, 39, 0.4) !important; }
    body.light-mode .text-white\/30 { color: rgba(17, 24, 39, 0.3) !important; }

    /* Border Inversions */
    body.light-mode .border-white\/10 { border-color: rgba(0,0,0,0.1) !important; }
    body.light-mode .border-white\/20 { border-color: rgba(0,0,0,0.2) !important; }
    body.light-mode .border-white\/30 { border-color: rgba(0,0,0,0.3) !important; }

    /* Input Placeholders */
    body.light-mode .placeholder-white\/30::placeholder { color: rgba(0,0,0,0.4); }
    body.light-mode .placeholder-white\/40::placeholder { color: rgba(0,0,0,0.5); }
    
    /* Hover states for interactive elements */
    body.light-mode .hover\:bg-white\/10:hover { background-color: rgba(0,0,0,0.05) !important; }
    body.light-mode .hover\:text-white:hover { color: #000 !important; }
    
    /* Specific fixes */
    body.light-mode #nav-menu-toggle { color: #111827; }
    body.light-mode #nav-menu-toggle:hover { color: #000; }
    body.light-mode #comments-drawer { background-color: rgba(255,255,255,0.95); }
    body.light-mode #comments-drawer .text-white { color: #111827; }
    body.light-mode #comments-drawer .text-white\/50 { color: rgba(17, 24, 39, 0.5); }
  </style>
 <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg text-white overflow-auto">
  <!-- Menu Backdrop (Z-40) - Covers content but sits BEHIND header (Z-50) -->
  <div id="menu-backdrop" class="fixed inset-0 z-40 bg-[#0f0c29]/70 hidden opacity-0 pointer-events-none"></div>

  <div class="min-h-full relative overflow-hidden"><div class="blob blob-1"></div>
   <div class="blob blob-2"></div>
   <div class="blob blob-3"></div>
   
   <!-- SOCIAL HUB HTML (Moved to top level of body for access) -->
   <div id="comments-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-md hidden opacity-0 transition-opacity duration-500 z-[90]"></div>

   <div id="comments-drawer" class="fixed inset-y-0 right-0 w-full sm:w-[420px] glass-dark border-l border-white/10 z-[100] transform translate-x-full transition-transform duration-500 ease-[cubic-bezier(0.32,0.72,0,1)] flex flex-col backdrop-blur-2xl bg-[#0f0c29]/95 shadow-2xl">
   
       <div class="p-5 border-b border-white/10 flex justify-between items-center bg-white/5">
       <h3 class="font-bold text-lg text-white flex items-center gap-2"><span>üí¨</span> Social Hub</h3>
       <button id="close-comments-btn" class="text-white/50 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-full">
           <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
       </button>
     </div>
   
       <div class="flex p-4 gap-2">
       <button id="tab-community" class="flex-1 py-2.5 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all font-medium text-sm">Community</button>
       <button id="tab-ai" class="flex-1 py-2.5 bg-transparent hover:bg-white/10 text-white/60 rounded-lg transition-all font-medium text-sm">AI Chat</button>
     </div>
   
       <div id="view-community" class="flex-1 flex flex-col min-h-0">
       <div id="comments-list" class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar"></div>
   
       <div class="p-4 border-t border-white/10 bg-black/20">
         <textarea id="comment-input" class="w-full p-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 text-sm focus:outline-none focus:border-purple-500/50 transition-colors resize-none" rows="2" placeholder="Write a message..."></textarea>
         <button id="send-comment-btn" class="mt-3 w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 text-white py-2.5 rounded-xl font-semibold shadow-lg shadow-purple-900/20 transition-all active:scale-[0.98]">Post Comment</button>
       </div>
     </div>
   
       <div id="view-ai" class="hidden flex-1 flex flex-col min-h-0">
       <div id="ai-chat-list" class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar"></div>
   
       <div class="p-4 border-t border-white/10 bg-black/20 flex gap-2">
         <input id="ai-input" class="flex-1 p-3 bg-white/5 border border-white/10 rounded-xl text-white placeholder-white/30 text-sm focus:outline-none focus:border-purple-500/50 transition-colors" placeholder="Ask AI...">
         <button onclick="sendAiMessage()" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-400 hover:to-pink-400 text-white px-6 rounded-xl font-semibold transition-all shadow-lg shadow-pink-900/20 active:scale-95">Send</button>
       </div>
     </div>
   
   </div>
   
   <!-- Scroll to Top Button -->
   <button id="scroll-top-btn" 
    class="fixed bottom-28 right-10 w-10 h-10 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-white shadow-lg flex items-center justify-center hover:bg-white/20 hover:scale-110 transition-all duration-300 z-40 opacity-0 pointer-events-none translate-y-4"
    onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
    title="Back to Top">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" /></svg>
   </button>
   
   <!-- Fixed Social Hub Icon on Right Side -->
   <button id="comments-toggle-btn"
    class="fixed bottom-8 right-8 h-14 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 text-white shadow-2xl flex items-center justify-center gap-0 hover:gap-3 px-0 hover:px-6 rounded-full transition-all duration-300 z-50 group border border-white/20 animate-in fade-in zoom-in w-14 hover:w-auto overflow-hidden"
    style="box-shadow: 0 0 30px rgba(139, 92, 246, 0.4);">
    <div class="relative flex-shrink-0 w-14 h-14 flex items-center justify-center">
       <span class="text-2xl group-hover:rotate-12 transition-transform drop-shadow-md">üí¨</span>
       <div class="absolute top-3 right-3 w-3 h-3 bg-red-500 rounded-full border-2 border-[#1a1a2e]"></div>
    </div>
    <span class="whitespace-nowrap font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-300 delay-100 hidden group-hover:block" data-translate="socialHub">Social Hub</span>
   </button>
   
   <!-- Account Switch Modal -->
   <div id="account-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4 modal-backdrop bg-black/80">
        <div class="glass modal-content rounded-3xl p-8 max-w-sm w-full relative">
            <button onclick="document.getElementById('account-modal').classList.add('hidden')" class="absolute top-4 right-4 p-2 rounded-full hover:bg-white/10 transition-colors">
               <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
            <h2 class="heading-font text-xl font-bold mb-6 text-center" data-translate="switchAccount">Switch Account</h2>
            
            <div id="account-list" class="space-y-3 mb-6">
                <!-- Accounts will be injected here -->
            </div>

            <button onclick="handleLogout()" class="w-full glass-dark py-3 rounded-xl font-semibold hover:bg-white/10 transition-colors flex items-center justify-center gap-2">
                <span>‚ûï</span> <span data-translate="addAccount">Add New Account</span>
            </button>
        </div>
   </div>

   <div id="login-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal-backdrop bg-black/70" style="backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);">
    <div class="glass modal-content rounded-3xl p-8 sm:p-12 w-full max-w-md max-h-screen overflow-y-auto relative">
        <button id="close-modal-btn" class="absolute top-6 right-6 text-white/60 hover:text-white transition-colors min-w-[44px] min-h-[44px] flex items-center justify-center z-10"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
        <div id="login-section" class="slide-right">
            <div class="flex items-center justify-between mb-6"><h2 class="heading-font text-2xl font-bold" data-translate="devLogin">Developer Login</h2></div>
            <div class="info-banner rounded-lg p-4 mb-6"><p class="text-sm text-white/80" data-translate="loginInfo">üìù Please fill in the details to use the website as a developer</p></div>
            <form id="login-form" class="space-y-4">
               <div class="form-group"><label class="block text-sm font-medium mb-2" data-translate="username">Username</label><input type="text" id="username-input" placeholder="Enter your username" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white placeholder-white/40 outline-none" required><div id="username-error" class="error-message hidden"></div></div>
               <div class="form-group"><label class="block text-sm font-medium mb-2" data-translate="password">Password</label><input type="password" id="password-input" placeholder="Enter your password" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white placeholder-white/40 outline-none" required><div id="password-error" class="error-message hidden"></div></div>
               <button type="submit" class="w-full glass px-6 py-3 rounded-lg font-semibold hover:bg-white/15 active:bg-white/20 transition-all flex items-center justify-center gap-2"> <span>üîì</span> <span data-translate="loginBtn">Login to Dashboard</span> </button>
            </form>
            <div class="text-center mt-6"><p class="text-white/60 text-sm mb-3" data-translate="forgotPass">Forgot your password?</p><button id="forgot-password-btn" class="text-blue-400 hover:text-blue-300 active:text-blue-500 transition-colors text-sm underline" data-translate="resetHere"> Click here to reset </button>
               <div class="mt-4 pt-4 border-t border-white/10"><p class="text-white/60 text-sm" data-translate="notReg">Not registered? <button id="get-registered-btn" class="text-green-400 hover:text-green-300 active:text-green-500 transition-colors font-medium ml-1 hover:underline" data-translate="getReg">Get registered</button></p></div>
           </div>
        </div>
        <!-- Register/Reset forms omitted for brevity as they are structural copies, but logic remains -->
        <div id="register-step-1" class="hidden slide-right">
             <div class="flex items-center justify-between mb-6"><h2 class="heading-font text-2xl font-bold">User Registration</h2><button class="back-to-login text-white/50 hover:text-white text-sm">Back</button></div>
             <form id="reg-form-1" class="space-y-4">
                 <div class="form-group"><label class="block text-sm font-medium mb-2">Username</label><input type="text" id="reg-username" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white placeholder-white/40 outline-none" required></div>
                 <div class="form-group"><label class="block text-sm font-medium mb-2">Email ID or Phone No</label><input type="text" id="reg-contact" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white placeholder-white/40 outline-none" required><div id="reg-error-1" class="error-message hidden"></div></div>
                 <button type="submit" class="w-full glass px-6 py-3 rounded-lg font-semibold hover:bg-white/15 active:bg-white/20 transition-all flex items-center justify-center gap-2"><span>üì©</span><span>Send OTP</span></button>
             </form>
        </div>
        <!-- ... other steps preserved ... -->
        <div id="register-step-2" class="hidden slide-right">
            <div class="flex items-center justify-between mb-6"><h2 class="heading-font text-2xl font-bold">Verify OTP</h2><button class="back-to-login text-white/50 hover:text-white text-sm">Back</button></div>
            <form id="reg-form-2" class="space-y-4"><div class="form-group"><input type="text" id="reg-otp" maxlength="6" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white text-center verification-code" required><div id="reg-error-2" class="error-message hidden"></div></div><button type="submit" class="w-full glass px-6 py-3 rounded-lg font-semibold hover:bg-white/15 active:bg-white/20 transition-all flex items-center justify-center gap-2"><span>‚úÖ</span><span>Verify & Continue</span></button></form>
        </div>
        <div id="register-step-3" class="hidden slide-right">
            <div class="flex items-center justify-between mb-6"><h2 class="heading-font text-2xl font-bold">Create Password</h2></div>
            <form id="reg-form-3" class="space-y-4">
                <div class="form-group"><label class="block text-sm font-medium mb-2">Create Password</label><input type="password" id="reg-pass" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white outline-none" required></div>
                <div class="form-group"><label class="block text-sm font-medium mb-2">Confirm Password</label><input type="password" id="reg-confirm-pass" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white outline-none" required><div id="reg-error-3" class="error-message hidden"></div></div>
                <button type="submit" class="w-full glass px-6 py-3 rounded-lg font-semibold hover:bg-white/15 active:bg-white/20 transition-all flex items-center justify-center gap-2"><span>üíæ</span><span>Confirm Registration</span></button>
            </form>
        </div>
        <div id="reset-step-1" class="hidden slide-right">
             <div class="flex items-center justify-between mb-6"><h2 class="heading-font text-2xl font-bold">Reset Password</h2><button class="back-to-login text-white/50 hover:text-white text-sm">Back</button></div>
             <form id="reset-form-1" class="space-y-4"><div class="form-group"><label class="block text-sm font-medium mb-2">Contact</label><input type="text" id="reset-contact" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white outline-none" required><div id="reset-error-1" class="error-message hidden"></div></div><button type="submit" class="w-full glass px-6 py-3 rounded-lg font-semibold hover:bg-white/15 active:bg-white/20 transition-all flex items-center justify-center gap-2"><span>üìß</span><span>Send OTP</span></button></form>
        </div>
        <div id="reset-step-2" class="hidden slide-right">
             <div class="flex items-center justify-between mb-6"><h2 class="heading-font text-2xl font-bold">Verify OTP</h2><button class="back-to-login text-white/50 hover:text-white text-sm">Back</button></div>
             <form id="reset-form-2" class="space-y-4"><div class="form-group"><input type="text" id="reset-otp" maxlength="6" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white text-center verification-code" required><div id="reset-error-2" class="error-message hidden"></div></div><button type="submit" class="w-full glass px-6 py-3 rounded-lg font-semibold hover:bg-white/15 active:bg-white/20 transition-all flex items-center justify-center gap-2"><span>‚úÖ</span><span>Confirm</span></button></form>
        </div>
        <div id="reset-step-3" class="hidden slide-right">
             <div class="flex items-center justify-between mb-6"><h2 class="heading-font text-2xl font-bold">New Password</h2></div>
             <form id="reset-form-3" class="space-y-4"><div class="form-group"><label class="block text-sm font-medium mb-2">New Password</label><input type="password" id="reset-pass" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white outline-none" required></div><div class="form-group"><label class="block text-sm font-medium mb-2">Confirm New Password</label><input type="password" id="reset-confirm-pass" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white outline-none" required><div id="reset-error-3" class="error-message hidden"></div></div><button type="submit" class="w-full glass px-6 py-3 rounded-lg font-semibold hover:bg-white/15 active:bg-white/20 transition-all flex items-center justify-center gap-2"><span>üíæ</span><span>Confirm</span></button></form>
        </div>
    </div>
   </div>
 
   <div id="settings-drawer" class="fixed inset-x-0 top-0 z-[80] hidden glass-dark border-b border-white/10 shadow-2xl flex flex-col max-h-[85vh] overflow-y-auto" style="backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);">
        <div class="max-w-4xl mx-auto w-full p-6 sm:p-8">
            <div class="flex items-center justify-between mb-8 border-b border-white/10 pb-4">
                <h2 class="heading-font text-2xl font-bold flex items-center gap-3"><span>‚öôÔ∏è</span> Settings & Preferences</h2>
               <button onclick="toggleSettings()" class="w-10 h-10 rounded-full glass hover:bg-white/20 flex items-center justify-center transition-colors">
                   <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
               </button>
           </div>
 
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
               <div class="space-y-6">
                   <div class="glass p-5 rounded-2xl flex items-center justify-between">
                       <div class="flex items-center gap-3">
                           <div class="w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center">üåô</div>
                           <div>
                                <h3 class="font-semibold" data-translate="darkMode">Dark Mode</h3>
                                <p class="text-xs text-white/50" data-translate="adjustTheme">Adjust system theme</p>
                           </div>
                       </div>
                       <label class="relative inline-flex items-center cursor-pointer">
                           <input type="checkbox" id="dark-mode-toggle" checked class="sr-only peer" onchange="toggleTheme()">
                           <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                       </label>
                   </div>
 
                   <div class="glass p-5 rounded-2xl flex items-center justify-between">
                       <div class="flex items-center gap-3">
                           <div class="w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center">üåê</div>
                           <div>
                                <h3 class="font-semibold" data-translate="language">Language</h3>
                                <p class="text-xs text-white/50" data-translate="selectLang">Select interface language</p>
                           </div>
                       </div>
                       <select id="language-selector" onchange="changeLanguage(this.value)" class="bg-black/30 border border-white/10 rounded-lg px-3 py-1.5 text-sm outline-none focus:ring-2 focus:ring-blue-500">
                           <option value="en">English (US)</option>
                           <option value="es">Espa√±ol</option>
                           <option value="fr">Fran√ßais</option>
                           <option value="ja">Êó•Êú¨Ë™û</option>
                           <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                       </select>
                   </div>
 
                   <div class="glass p-5 rounded-2xl flex items-center justify-between cursor-pointer hover:bg-white/5 transition-colors" onclick="switchAccount()">
                       <div class="flex items-center gap-3">
                           <div class="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">üîÑ</div>
                           <div>
                                <h3 class="font-semibold" data-translate="switchAcc">Switch Account</h3>
                                <p class="text-xs text-white/50" data-translate="logoutChange">Log out and change user</p>
                           </div>
                       </div>
                       <svg class="w-5 h-5 text-white/40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                   </div>
               </div>
 
               <div class="glass p-5 rounded-2xl flex flex-col h-full">
                   <div class="flex items-center justify-between mb-4">
                       <div class="flex items-center gap-3">
                           <div class="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center">üïí</div>
                           <div>
                                <h3 class="font-semibold" data-translate="history">Viewing History</h3>
                                <p class="text-xs text-white/50" data-translate="prevVisited">Previously visited images</p>
                           </div>
                       </div>
                       <div class="flex gap-2">
                           <button onclick="toggleHistoryTracking()" class="text-xs px-2 py-1 rounded bg-white/10 hover:bg-white/20 transition-colors" id="history-toggle-btn">Pause</button>
                           <button onclick="clearHistory()" class="text-xs px-2 py-1 rounded bg-red-500/20 text-red-300 hover:bg-red-500/30 transition-colors">Clear</button>
                       </div>
                   </div>
                   
                   <div id="history-list" class="flex-1 overflow-x-auto whitespace-nowrap pb-2 space-x-3 min-h-[100px] flex items-center">
                       <p class="text-white/30 text-sm w-full text-center italic">No recently viewed images.</p>
                   </div>
               </div>
           </div>
        </div>
   </div>

   <!-- Moved Header OUT of main-container and set Z-Index higher -->
   <header class="glass sticky top-0 z-50">
     <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 sm:py-4">
      <div class="flex items-center justify-between gap-4">
       <div class="flex items-center gap-2 sm:gap-3 min-w-0 flex-1 relative">
        <div id="logo-icon-toggle" class="cursor-pointer w-8 h-8 sm:w-10 sm:h-10 rounded-lg flex items-center justify-center flex-shrink-0 bg-gradient-to-br from-cyan-400 to-blue-600 transition-transform active:scale-95">
            <span class="text-xs sm:text-sm font-bold heading-font">AV</span>
        </div>
        <button id="nav-menu-toggle" class="heading-font font-semibold text-sm sm:text-base truncate hover:text-white/80 transition-colors flex items-center gap-1.5 min-h-[44px]"> Avanode Digitals 
         <svg id="menu-chevron" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
        </svg></button> <div id="nav-dropdown" class="absolute top-full left-0 mt-2 glass rounded-xl shadow-2xl min-w-max hidden z-50">
         <nav class="py-2">
          <a href="#" class="nav-link px-4 sm:px-6 py-3 flex items-center gap-3 text-sm sm:text-base hover:bg-white/10 transition-colors first:rounded-t-xl" onclick="return handleNavLink(event, 'about')"> <span>‚ÑπÔ∏è</span> <span data-translate="about">About Our Company</span> </a> 
          <a href="#" class="nav-link px-4 sm:px-6 py-3 flex items-center gap-3 text-sm sm:text-base hover:bg-white/10 transition-colors" onclick="return handleNavLink(event, 'social')"> <span>üë•</span> <span data-translate="social">Our Social Group</span> </a> 
          <a href="#" class="nav-link px-4 sm:px-6 py-3 flex items-center gap-3 text-sm sm:text-base hover:bg-white/10 transition-colors" onclick="return handleNavLink(event, 'anime')"> <span>üé®</span> <span data-translate="anime">Anime &amp; Animated Wallpapers</span> </a> 
          <a href="#" class="nav-link px-4 sm:px-6 py-3 flex items-center gap-3 text-sm sm:text-base hover:bg-white/10 transition-colors" onclick="return handleNavLink(event, 'chat-community')"> <span>üí¨</span> <span data-translate="chatComm">Chat Community</span> </a>
          <a href="#" class="nav-link px-4 sm:px-6 py-3 flex items-center gap-3 text-sm sm:text-base hover:bg-white/10 transition-colors" onclick="return handleNavLink(event, 'chatbot')"> 
            <div class="w-6 h-6 rounded-full overflow-hidden flex-shrink-0 border border-white/30 bg-black/50">
             <img src="https://api.dicebear.com/9.x/bottts-neutral/svg?seed=AvanodeAI" alt="AI" class="w-full h-full object-cover">
            </div>
            <span data-translate="aiChat">AI Chatbot</span> 
           </a>
          <a href="#" class="nav-link px-4 sm:px-6 py-3 flex items-center gap-3 text-sm sm:text-base hover:bg-white/10 transition-colors" onclick="return handleNavLink(event, 'premium-store')"> <span>üëë</span> <span data-translate="premium">Premium Subscription</span> </a>
          <a href="#" class="nav-link px-4 sm:px-6 py-3 flex items-center gap-3 text-sm sm:text-base hover:bg-white/10 transition-colors last:rounded-b-xl" onclick="return handleNavLink(event, 'support')"> <span>üÜò</span> <span data-translate="support">Customer Support</span> </a>
         </nav>
        </div>
       </div><div id="bulk-actions" class="hidden flex-1 flex justify-center items-center gap-2 animate-in fade-in slide-in-from-top-4 duration-300">
            <!-- Bulk actions retained -->
             <label class="flex items-center gap-2 cursor-pointer glass-dark px-3 py-2 rounded-lg text-sm hover:bg-white/10 select-none">
                <input type="checkbox" id="select-all-checkbox" class="w-4 h-4 rounded border-white/30 text-blue-500 focus:ring-offset-0 focus:ring-blue-500 bg-white/10 cursor-pointer">
                <span class="text-xs sm:text-sm font-medium">All</span>
            </label>
            <button onclick="deselectAll()" class="glass-dark px-3 py-2 rounded-lg text-sm font-medium hover:bg-white/10 text-white/80 transition-colors flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
            <!-- ... -->
        </div>
 
       <nav class="flex items-center justify-end gap-2 sm:gap-4 flex-shrink-0 ml-auto">
        <button id="top-subscribe-btn" onclick="handleNavLink(event, 'subscription')" class="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-400 hover:to-orange-400 text-white px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm font-bold shadow-lg flex items-center gap-2 min-h-[44px] transition-all hover:scale-105 active:scale-95">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
         <span class="hidden sm:inline" data-translate="subscription">Subscription</span>
        </button>
        
        <div id="dev-panel" class="hidden relative">
            <button id="user-profile-btn" class="flex items-center gap-3 bg-white/5 hover:bg-white/10 rounded-full pl-1 pr-4 py-1 border border-white/10 transition-all z-[60]">
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-green-400 to-blue-500 flex items-center justify-center text-sm font-bold shadow-lg">
                    <span id="user-avatar-initial">U</span>
                </div>
                <div class="flex flex-col items-start text-left">
                    <span id="dev-username-display" class="text-xs font-bold text-white leading-none mb-0.5 max-w-[80px] truncate">User</span>
                    <span class="text-[10px] text-green-400 leading-none">Online</span>
                </div>
                <svg class="w-3 h-3 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
            </button>
 
            <div id="user-profile-menu" class="absolute top-full right-0 mt-2 w-64 glass rounded-2xl shadow-2xl p-2 hidden z-50 transform origin-top-right transition-all">
                <div class="p-2 mb-2 border-b border-white/10">
                    <p class="text-xs text-white/50 uppercase tracking-widest font-bold" data-translate="account">Account</p>
                </div>
                <button onclick="handleProfileOption('edit')" class="w-full text-left px-4 py-3 rounded-xl hover:bg-white/10 flex items-center gap-3 transition-colors group">
                    <span class="bg-blue-500/20 p-2 rounded-lg text-blue-400 group-hover:bg-blue-500 group-hover:text-white transition-colors">‚úèÔ∏è</span>
                    <span class="text-sm font-medium" data-translate="editProfile">Edit Profile</span>
                </button>
                <button onclick="handleProfileOption('subscriptions')" class="w-full text-left px-4 py-3 rounded-xl hover:bg-white/10 flex items-center gap-3 transition-colors group">
                    <span class="bg-purple-500/20 p-2 rounded-lg text-purple-400 group-hover:bg-purple-500 group-hover:text-white transition-colors">üíé</span>
                    <span class="text-sm font-medium" data-translate="yourSubs">Your Subscriptions</span>
                </button>
                <button onclick="handleProfileOption('saved')" class="w-full text-left px-4 py-3 rounded-xl hover:bg-white/10 flex items-center gap-3 transition-colors group">
                    <span class="bg-green-500/20 p-2 rounded-lg text-green-400 group-hover:bg-green-500 group-hover:text-white transition-colors">üîñ</span>
                    <span class="text-sm font-medium" data-translate="saved">Saved</span>
                </button>
                <!-- NEW CUSTOMIZE OPTION -->
                <button onclick="handleProfileOption('customize')" class="w-full text-left px-4 py-3 rounded-xl hover:bg-white/10 flex items-center gap-3 transition-colors group">
                    <span class="bg-orange-500/20 p-2 rounded-lg text-orange-400 group-hover:bg-orange-500 group-hover:text-white transition-colors">‚öôÔ∏è</span>
                    <span class="text-sm font-medium" data-translate="customize">Customize Profile</span>
                </button>
                
                <button onclick="handleProfileOption('settings')" class="w-full text-left px-4 py-3 rounded-xl hover:bg-white/10 flex items-center gap-3 transition-colors group">
                    <span class="bg-gray-500/20 p-2 rounded-lg text-gray-300 group-hover:bg-gray-500 group-hover:text-white transition-colors">‚öôÔ∏è</span>
                    <span class="text-sm font-medium" data-translate="settings">Settings</span>
                </button>
                <div class="h-px bg-white/10 my-1 mx-2"></div>
                <button id="logout-btn-menu" class="w-full text-left px-4 py-3 rounded-xl hover:bg-red-500/20 text-red-300 flex items-center gap-3 transition-colors">
                    <span class="p-2">üö™</span>
                    <span class="text-sm font-medium" data-translate="logout">Logout</span>
                </button>
            </div>
        </div>
 
        <button id="logout-btn" class="hidden"></button> <button id="open-login-btn" class="glass-dark px-3 sm:px-4 py-2 rounded-lg text-xs sm:text-sm hover:bg-white/10 active:bg-white/20 transition-colors flex items-center gap-2 min-h-[44px]"> <span>üîê</span> <span class="hidden sm:inline" data-translate="devLogin">Developer Login</span> </button>
       </nav>
      </div>
     </div>
    </header>

   <div id="main-container" class="relative z-10 w-full min-h-full">
    <!-- Removed Tab Section as per original request -->
    <!-- Content sections follow... -->
    
    <div id="view-mode" class="min-h-full"><section id="profile" class="py-16 sm:py-24 px-4 sm:px-6">
      <div class="max-w-7xl mx-auto">
       <div class="glass rounded-3xl p-6 sm:p-12 fade-in"><div class="text-center mb-12">
         <div class="flex items-center justify-center gap-3 mb-4">
          <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 bg-gradient-to-br from-cyan-400 to-blue-600"><span class="text-lg font-bold heading-font">AV</span>
          </div>
          <h1 class="heading-font text-2xl sm:text-3xl font-bold">Avanode Digitals</h1>
         </div>
         <p class="text-white/70 text-sm sm:text-base">Future Tech ‚Ä¢ Immersive Animation ‚Ä¢ Artificial Intelligence</p>
        </div><div class="relative py-16 sm:py-20 px-6 sm:px-12"><div class="absolute left-0 top-1/2 -translate-y-1/2 text-5xl sm:text-7xl opacity-50 animate-float">
          ‚ú®
         </div><div class="text-center px-4 sm:px-12 flex flex-col items-center">
          
          <div id="mascot-container" class="fade-in animate-float"></div>
          <div class="mb-8">
           <h2 class="heading-font text-4xl sm:text-6xl font-bold bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-500 bg-clip-text text-transparent mb-3">Avanode Studios</h2>
           <p class="heading-font text-3xl sm:text-5xl font-semibold text-white/90">Digital Animation Arts</p>
          </div>
         </div><div class="absolute right-0 top-1/2 -translate-y-1/2 text-5xl sm:text-7xl opacity-50 animate-float" style="animation-delay: -2s;">
          üé®
         </div>
        </div><div class="flex flex-wrap gap-2 justify-center mb-10 mt-12"><span class="skill-tag glass-dark px-4 py-2 rounded-full text-sm">üé® Digital Art</span> <span class="skill-tag glass-dark px-4 py-2 rounded-full text-sm">üîÆ VFX</span> <span class="skill-tag glass-dark px-4 py-2 rounded-full text-sm">‚ö° Web Dev</span> <span class="skill-tag glass-dark px-4 py-2 rounded-full text-sm">ü§ñ AI Gen</span> <span class="skill-tag glass-dark px-4 py-2 rounded-full text-sm">üé¨ Motion</span> <span class="skill-tag glass-dark px-4 py-2 rounded-full text-sm"> UI/UX</span>
        </div><div class="flex flex-wrap gap-6 sm:gap-8 justify-center">
         <div class="text-center">
          <div class="heading-font text-2xl sm:text-3xl font-bold">
           50+
          </div>
          <div class="text-white/50 text-sm">
           Projects
          </div>
         </div>
         <div class="text-center">
          <div class="heading-font text-2xl sm:text-3xl font-bold" id="stat-images">
           0
          </div>
          <div class="text-white/50 text-sm">
           Gallery Items
          </div>
         </div>
         <div class="text-center">
          <div class="heading-font text-2xl sm:text-3xl font-bold">
           3+
          </div>
          <div class="text-white/50 text-sm">
           Years Exp
          </div>
         </div>
        </div>
       </div>
      </div>
     </section>
     
     <div id="customize-mode" class="min-h-full hidden">
        <div class="max-w-4xl mx-auto py-12 px-4 sm:px-6">
            <button onclick="exitCustomizeMode()" class="mb-6 flex items-center gap-2 text-white/70 hover:text-white transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
                <span data-translate="backToHome">Back to Home</span>
            </button>
            <div class="glass rounded-3xl p-6 sm:p-10 mb-6">
                <h2 class="heading-font text-2xl font-bold mb-6 flex items-center gap-3"><span>üë§</span> <span data-translate="profileInfo">Profile Information</span></h2>
                <div class="space-y-6">
                    <div><label class="block text-sm font-medium mb-2">Your Name</label> <input type="text" id="customize-name" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white placeholder-white/40 outline-none" placeholder="Enter your full name"></div>
                    <div><label class="block text-sm font-medium mb-2">Professional Title</label> <input type="text" id="customize-title" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white placeholder-white/40 outline-none" placeholder="e.g., Creative Developer &amp; Digital Artist"></div>
                    <div><label class="block text-sm font-medium mb-2">Bio</label> <textarea id="customize-bio" class="input-field w-full glass-dark rounded-lg px-4 py-3 text-white placeholder-white/40 outline-none resize-none" placeholder="Tell us about yourself..." rows="4"></textarea></div>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-4 mb-20">
                <button id="save-customize-btn" class="flex-1 glass px-6 py-3 rounded-lg font-semibold hover:bg-white/15 active:bg-white/20 transition-all flex items-center justify-center gap-2 min-h-[44px]"><span>üíæ</span><span data-translate="saveChanges">Save All Changes</span></button>
            </div>
        </div>
     </div>
     
     <!-- Subscription Section -->
     <section id="subscription" class="py-12 px-4 sm:px-6">
      <div class="max-w-7xl mx-auto">
       <div class="text-center mb-12">
        <h2 class="heading-font text-3xl sm:text-4xl font-bold mb-4">Choose Your Plan</h2>
        <p class="text-white/60">Unlock the full potential of Avanode Digitals with our premium tiers.</p>
       </div>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
        <div class="glass p-8 rounded-3xl relative overflow-hidden group hover:bg-white/5 transition-all">
         <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
          <svg class="w-24 h-24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L1 21h22L12 2zm0 3.516L20.297 19H3.703L12 5.516z"/></svg>
         </div>
         <h3 class="text-xl font-bold mb-2">Explorer</h3>
         <div class="text-3xl font-bold mb-6">$0<span class="text-sm font-normal text-white/50">/mo</span></div>
         <ul class="space-y-3 mb-8 text-sm text-white/70">
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Full Gallery Access</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> View Community Comments</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-white/30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg> No Image Uploads</li>
         </ul>
         <button onclick="upgradeTier('free')" class="w-full glass-dark py-3 rounded-xl font-semibold hover:bg-white/10 transition-colors">Current Plan</button>
        </div>
        <div class="glass p-8 rounded-3xl relative overflow-hidden ring-2 ring-purple-500 bg-purple-500/10 transform scale-105 shadow-2xl">
         <div class="absolute top-0 right-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-bold px-3 py-1 rounded-bl-xl">POPULAR</div>
         <h3 class="text-xl font-bold mb-2">Creator</h3>
         <div class="text-3xl font-bold mb-6">$19<span class="text-sm font-normal text-white/50">/mo</span></div>
         <ul class="space-y-3 mb-8 text-sm text-white/80">
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Publish Unlimited Images</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> High-Res Downloads</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Priority Support</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Advanced AI Tools</li>
         </ul>
         <button class="w-full bg-gradient-to-r from-purple-500 to-pink-500 py-3 rounded-xl font-semibold hover:shadow-lg hover:scale-[1.02] transition-all">Get Started</button>
        </div>
       </div>
      </div>
     </section>
     
     <!-- Gallery -->
     <section id="gallery" class="py-12 px-4 sm:px-6">
        <div class="max-w-7xl mx-auto"><div class="flex flex-col sm:flex-row items-center justify-between gap-4 mb-8">
            <div class="flex flex-wrap items-center gap-3 w-full sm:w-auto">
                <h2 class="heading-font text-2xl sm:text-3xl font-bold" id="gallery-title" data-translate="multimediaGallery">üñºÔ∏è Multimedia Gallery</h2>
                <button id="gallery-select-all-btn" onclick="toggleSelectAll()" class="glass-dark px-3 py-2 rounded-lg text-sm font-medium hover:bg-white/10 active:bg-white/20 transition-colors flex items-center gap-2">
                    <div id="gallery-select-all-icon" class="w-4 h-4 rounded border border-white/40 flex items-center justify-center"></div>
                    <span class="hidden sm:inline text-sm" data-translate="selectAll">Select All</span>
                </button>
                <button onclick="handleUploadClick()" class="glass-dark px-3 py-2 rounded-lg text-sm font-medium hover:bg-white/10 active:bg-white/20 transition-colors flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                    <span class="hidden sm:inline text-sm" data-translate="upload">Upload</span>
                </button>
                <button id="clear-all-btn" onclick="clearAllImages()" class="glass-dark px-3 py-2 rounded-lg text-sm font-medium hover:bg-red-500/20 text-red-300 transition-colors flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                    <span class="hidden sm:inline" data-translate="clearAll">Clear All</span>
                </button>
            </div>
            <div class="relative w-full sm:w-80"><input type="text" id="search-input" placeholder="Search images..." class="search-input w-full glass-dark rounded-xl px-5 py-3 pl-12 text-white placeholder-white/40 outline-none"><svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></div>
        </div>
        <div id="gallery-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8"></div>
        <div id="empty-state" class="glass rounded-2xl p-12 text-center hidden">
            <div class="w-24 h-24 rounded-full glass-dark flex items-center justify-center mx-auto mb-6"><svg class="w-12 h-12 text-white/40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg></div>
            <h3 class="heading-font text-xl font-semibold mb-2" data-translate="noImages">No images found</h3>
            <p class="text-white/50" data-translate="uploadFirst">Upload your first image to start building your gallery!</p>
        </div>
        </div>
     </section>
     
     <!-- Contact Section -->
     <section id="contact" class="py-12 px-4 sm:px-6">
      <div class="max-w-3xl mx-auto">
       <div class="glass rounded-3xl p-6 sm:p-10 text-center">
        <h2 class="heading-font text-2xl sm:text-3xl font-bold mb-4">Let's Connect</h2>
        <p class="text-white/60 mb-8">Interested in collaborating on Animation Arts, 3D Web Design, Renewable Energy Research, or just want to say hi? Feel free to reach out to Rohit Phogat!</p>
        <div class="flex flex-wrap justify-center gap-4">
         <a href="mailto:contact@avanodedigitals.com" target="_blank" rel="noopener noreferrer" class="glass-dark px-6 py-3 rounded-xl flex items-center gap-2 hover:bg-white/10 active:bg-white/20 transition-colors min-h-[44px]"> <svg class="w-5 h-5 text-[#ea4335]" fill="currentColor" viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg> Email </a> 
         <a href="https://linkedin.com/in/rohitphogat" target="_blank" rel="noopener noreferrer" class="glass-dark px-6 py-3 rounded-xl flex items-center gap-2 hover:bg-white/10 active:bg-white/20 transition-colors min-h-[44px]"> <svg class="w-5 h-5 text-[#0A66C2]" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg> LinkedIn </a> 
         <a href="https://github.com/RohitPhogat222" target="_blank" rel="noopener noreferrer" class="glass-dark px-6 py-3 rounded-xl flex items-center gap-2 hover:bg-white/10 active:bg-white/20 transition-colors min-h-[44px]"> <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.166 6.839 9.489.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.603-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.462-1.11-1.462-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.114 2.504.336 1.909-1.294 2.747-1.025 2.747-1.025.546 1.379.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.161 22 16.418 22 12c0-5.523-4.477-10-10-10z"/></svg> GitHub </a>
         <a href="https://wa.me/" target="_blank" rel="noopener noreferrer" class="glass-dark px-6 py-3 rounded-xl flex items-center gap-2 hover:bg-white/10 active:bg-white/20 transition-colors min-h-[44px]"> <svg class="w-5 h-5 text-[#25D366]" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51a12.8 12.8 0 00-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg> WhatsApp </a> 
         <a href="https://twitter.com/RohitPhogat222" target="_blank" rel="noopener noreferrer" class="glass-dark px-6 py-3 rounded-xl flex items-center gap-2 hover:bg-white/10 active:bg-white/20 transition-colors min-h-[44px]"> <svg class="w-5 h-5 text-[#1DA1F2]" fill="currentColor" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg> Twitter </a>
        </div>
       </div>
      </div>
     </section>
 
     <!-- About Section -->
     <section id="about" class="py-16 px-4 sm:px-6 relative">
         <div class="absolute top-0 right-0 p-12 opacity-30 pointer-events-none">
             <div class="w-64 h-64 bg-cyan-500 rounded-full filter blur-[100px]"></div>
         </div>
         <div class="max-w-7xl mx-auto glass rounded-3xl p-8 sm:p-12">
             <div class="flex flex-col md:flex-row gap-12 items-center">
                <div class="md:w-1/2">
                    <h2 class="heading-font text-3xl sm:text-4xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-white to-cyan-200">About Avanode</h2>
                    <p class="text-white/70 mb-4 leading-relaxed">
                        Founded in 2026 by Rohit Phogat, <strong>Avanode Digitals</strong> stands at the intersection of artistic expression and technological innovation. We are not just a digital art studio; we are a hub for the next generation of immersive experiences.
                    </p>
                    <p class="text-white/70 mb-6 leading-relaxed">
                        Our mission is to democratize high-end digital animation and 3D design, providing creators with the tools and inspiration they need to build worlds that don't yet exist. From sustainable tech integration to AI-driven creativity, we are shaping the future of digital art.
                    </p>
                    <div class="flex gap-4">
                        <div class="glass-dark p-4 rounded-xl text-center flex-1">
                            <div class="text-2xl mb-1">üöÄ</div>
                            <div class="text-sm font-bold text-cyan-400">Innovation</div>
                        </div>
                        <div class="glass-dark p-4 rounded-xl text-center flex-1">
                            <div class="text-2xl mb-1">üå±</div>
                            <div class="text-sm font-bold text-green-400">Sustainability</div>
                        </div>
                        <div class="glass-dark p-4 rounded-xl text-center flex-1">
                            <div class="text-2xl mb-1">üé®</div>
                            <div class="text-sm font-bold text-purple-400">Creativity</div>
                        </div>
                    </div>
                </div>
                <div class="md:w-1/2 relative">
                    <div class="aspect-video rounded-2xl bg-gradient-to-br from-cyan-900/40 to-purple-900/40 border border-white/10 flex items-center justify-center overflow-hidden">
                        <img src="https://raw.githubusercontent.com/RohitPhogat222/Avanode.index.html/main/Gemini_Generated_Image_soub2ssoub2ssoub.png" alt="Avanode Character" class="w-full h-full object-cover hover:scale-105 transition-transform duration-700">
                    </div>
                </div>
            </div>
         </div>
     </section>
 
     <!-- Support Section -->
     <section id="support" class="py-12 px-4 sm:px-6">
        <div class="max-w-4xl mx-auto glass rounded-3xl p-8 text-center">
            <h2 class="heading-font text-3xl font-bold mb-4">Customer Support Center</h2>
            <p class="text-white/60 mb-8">Experiencing issues with your subscription or gallery uploads? Our dedicated team is here to help.</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
               <button class="glass-dark p-6 rounded-xl hover:bg-white/10 transition-colors group">
                   <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üé´</div>
                   <h3 class="font-bold mb-1">Submit Ticket</h3>
                   <p class="text-xs text-white/50">Response within 24h</p>
               </button>
               <button class="glass-dark p-6 rounded-xl hover:bg-white/10 transition-colors group">
                   <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üí¨</div>
                   <h3 class="font-bold mb-1">Live Chat</h3>
                   <p class="text-xs text-white/50">Available 9am - 5pm</p>
               </button>
               <button class="glass-dark p-6 rounded-xl hover:bg-white/10 transition-colors group">
                   <div class="text-3xl mb-3 group-hover:scale-110 transition-transform">üìö</div>
                   <h3 class="font-bold mb-1">Knowledge Base</h3>
                   <p class="text-xs text-white/50">Tutorials & FAQs</p>
               </button>
           </div>
            
            <div class="mt-8 pt-6 border-t border-white/10">
                <p class="text-sm text-white/40">Direct Hotline: <span class="text-white font-bold">+91 70151 23151</span></p>
           </div>
        </div>
     </section>
 
     <footer id="main-footer" class="glass mt-8">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
       <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
         <div class="flex items-center gap-3 mb-4">
          <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 bg-gradient-to-br from-cyan-400 to-blue-600"><span class="text-lg font-bold heading-font">AV</span>
          </div><span class="heading-font font-semibold">Avanode Digitals</span>
         </div>
         <p class="text-white/50 text-sm">Founded by Rohit Phogat. Specializing in high-end animation, digital arts, immersive 3D experiences, and AI integration for the future of creative technology.</p>
        </div>
        <div>
         <h4 class="heading-font font-semibold mb-4" data-translate="quickLinks">Quick Links</h4>
         <div class="flex flex-col gap-2"><a href="#profile" class="text-white/50 hover:text-white transition-colors text-sm">Profile</a> <a href="#gallery" class="text-white/50 hover:text-white transition-colors text-sm">Gallery</a> <a href="#contact" class="text-white/50 hover:text-white transition-colors text-sm">Contact</a>
         </div>
        </div>
        <div>
         <h4 class="heading-font font-semibold mb-4" data-translate="focusAreas">Focus Areas</h4>
         <div class="flex flex-wrap gap-2">
          <span class="text-xs glass-dark px-3 py-1 rounded-full text-white/60">Digital Arts</span> 
          <span class="text-xs glass-dark px-3 py-1 rounded-full text-white/60">Motion Graphics</span> 
          <span class="text-xs glass-dark px-3 py-1 rounded-full text-white/60">3D Design</span>
          <span class="text-xs glass-dark px-3 py-1 rounded-full text-white/60">AI Generation</span>
          <span class="text-xs glass-dark px-3 py-1 rounded-full text-white/60">VFX</span>
          <span class="text-xs glass-dark px-3 py-1 rounded-full text-white/60">UI/UX</span>
         </div>
        </div>
       </div>
       <div class="border-t border-white/10 mt-8 pt-6 flex flex-col sm:flex-row items-center justify-between gap-4">
        <p class="text-white/40 text-sm">¬© 2026 Avanode Digitals Animation Arts by Rohit Phogat. All rights reserved.</p>
        <div class="flex flex-col items-center sm:items-end">
            <p class="text-white/40 text-sm flex items-center gap-2">Empowering <span class="text-cyan-400">üé®</span> with digital innovation</p>
            <p id="support-phone" class="text-purple-400 text-lg font-bold mt-1 transition-all duration-300">Support: +91 70151 23151</p>
        </div>
       </div><div class="online-bar">
        <div class="online-indicator"><span class="online-dot"></span> <span class="online-text"> <span class="online-count">127</span> <span data-translate="online">people online</span> </span>
        </div>
       </div>
      </div>
     </footer>
    </div>
  </div>
 
  <script>
    // ... [Previous Script Content Remains Identical] ...
    // Note: No changes needed in logic, only HTML structure was modified for stacking context.
    
    // ==================== GLOBAL HELPERS ====================
    function clearErrors() {
      document.querySelectorAll('.error-message').forEach(el => {
        el.classList.add('hidden');
        el.textContent = '';
      });
    }
 
    function showSection(sectionId) {
        ['login-section', 'register-step-1', 'register-step-2', 'register-step-3', 
         'reset-step-1', 'reset-step-2', 'reset-step-3'].forEach(id => {
            const el = document.getElementById(id);
            if(el) el.classList.add('hidden');
        });
        const target = document.getElementById(sectionId);
        if(target) target.classList.remove('hidden');
        clearErrors();
    }
 
    function showError(elementId, message) {
      const errorEl = document.getElementById(elementId);
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.classList.remove('hidden');
      }
    }
 
    function simplePasswordHash(password) {
      let hash = 0;
      for (let i = 0; i < password.length; i++) {
        const char = password.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      return 'hash_' + Math.abs(hash).toString(36);
    }
 
    // ==================== TRANSLATION SYSTEM ====================
    const translations = {
        en: {
            about: "About Our Company", social: "Our Social Group", anime: "Anime & Animated Wallpapers",
            chatComm: "Chat Community", aiChat: "AI Chatbot", premium: "Premium Subscription", support: "Customer Support",
            settings: "‚öôÔ∏è Settings & Preferences", darkMode: "Dark Mode", adjustTheme: "Adjust system theme",
            language: "Language", selectLang: "Select interface language", switchAcc: "Switch Account",
            logoutChange: "Log out and change user", history: "Viewing History", prevVisited: "Previously visited images",
            account: "Account", editProfile: "Edit Profile", yourSubs: "Your Subscriptions", saved: "Saved",
            customize: "Customize Profile", logout: "Logout", devLogin: "Developer Login", loginInfo: "üìù Please fill in the details",
            username: "Username", password: "Password", loginBtn: "Login to Dashboard", forgotPass: "Forgot your password?",
            resetHere: "Click here to reset", notReg: "Not registered?", getReg: "Get registered",
            subscription: "Subscription", multimediaGallery: "üñºÔ∏è Multimedia Gallery", selectAll: "Select All",
            upload: "Upload", clearAll: "Clear All", noImages: "No images found", uploadFirst: "Upload your first image to start building your gallery!",
            quickLinks: "Quick Links", focusAreas: "Focus Areas", online: "people online",
            switchAccount: "Switch Account", addAccount: "Add New Account", backToHome: "Back to Home", saveChanges: "Save All Changes",
            profileInfo: "Profile Information", recUpgrades: "Recommended Upgrades"
        },
        es: {
            about: "Sobre Nuestra Empresa", social: "Nuestro Grupo Social", anime: "Anime y Fondos Animados",
            chatComm: "Comunidad de Chat", aiChat: "Chatbot IA", premium: "Suscripci√≥n Premium", support: "Atenci√≥n al Cliente",
            settings: "‚öôÔ∏è Ajustes y Preferencias", darkMode: "Modo Oscuro", adjustTheme: "Ajustar tema del sistema",
            language: "Idioma", selectLang: "Seleccionar idioma", switchAcc: "Cambiar Cuenta",
            logoutChange: "Cerrar sesi√≥n y cambiar", history: "Historial de Vistas", prevVisited: "Im√°genes vistas anteriormente",
            account: "Cuenta", editProfile: "Editar Perfil", yourSubs: "Tus Suscripciones", saved: "Guardados",
            customize: "Personalizar Perfil", logout: "Cerrar Sesi√≥n", devLogin: "Acceso Desarrollador", loginInfo: "üìù Complete los detalles",
            username: "Usuario", password: "Contrase√±a", loginBtn: "Entrar al Panel", forgotPass: "¬øOlvid√≥ su contrase√±a?",
            resetHere: "Clic para restablecer", notReg: "¬øNo registrado?", getReg: "Registrarse",
            subscription: "Suscripci√≥n", multimediaGallery: "üñºÔ∏è Galer√≠a Multimedia", selectAll: "Seleccionar Todo",
            upload: "Subir", clearAll: "Borrar Todo", noImages: "No se encontraron im√°genes", uploadFirst: "¬°Sube tu primera imagen para comenzar!",
            quickLinks: "Enlaces R√°pidos", focusAreas: "√Åreas de Enfoque", online: "personas en l√≠nea",
            switchAccount: "Cambiar Cuenta", addAccount: "A√±adir Nueva Cuenta", backToHome: "Volver al Inicio", saveChanges: "Guardar Cambios",
            profileInfo: "Informaci√≥n de Perfil", recUpgrades: "Mejoras Recomendadas"
        },
        fr: {
            about: "√Ä Propos de Nous", social: "Notre Groupe Social", anime: "Anim√©s & Fonds d'√©cran",
            chatComm: "Communaut√© de Chat", aiChat: "Chatbot IA", premium: "Abonnement Premium", support: "Service Client",
            settings: "‚öôÔ∏è Param√®tres", darkMode: "Mode Sombre", adjustTheme: "Ajuster le th√®me",
            language: "Langue", selectLang: "Choisir la langue", switchAcc: "Changer de Compte",
            logoutChange: "D√©connexion et changement", history: "Historique", prevVisited: "Images vues pr√©c√©demment",
            account: "Compte", editProfile: "Modifier le Profil", yourSubs: "Vos Abonnements", saved: "Enregistr√©",
            customize: "Personnaliser le Profil", logout: "D√©connexion", devLogin: "Acc√®s D√©veloppeur", loginInfo: "üìù Remplissez les d√©tails",
            username: "Nom d'utilisateur", password: "Mot de passe", loginBtn: "Connexion", forgotPass: "Mot de passe oubli√© ?",
            resetHere: "Cliquez pour r√©initialiser", notReg: "Pas inscrit ?", getReg: "S'inscrire",
            subscription: "Abonnement", multimediaGallery: "üñºÔ∏è Galerie Multim√©dia", selectAll: "Tout S√©lectionner",
            upload: "T√©l√©charger", clearAll: "Tout Effacer", noImages: "Aucune image trouv√©e", uploadFirst: "T√©l√©chargez votre premi√®re image !",
            quickLinks: "Liens Rapides", focusAreas: "Domaines", online: "personnes en ligne",
            switchAccount: "Changer de Compte", addAccount: "Ajouter un Compte", backToHome: "Retour √† l'Accueil", saveChanges: "Enregistrer",
            profileInfo: "Informations de Profil", recUpgrades: "Mises √† niveau recommand√©es"
        },
        ja: {
            about: "‰ºöÁ§æÊ¶ÇË¶Å", social: "„ÇΩ„Éº„Ç∑„É£„É´„Ç∞„É´„Éº„Éó", anime: "„Ç¢„Éã„É°„Å®Â£ÅÁ¥ô",
            chatComm: "„ÉÅ„É£„ÉÉ„Éà„Ç≥„Éü„É•„Éã„ÉÜ„Ç£", aiChat: "AI„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà", premium: "„Éó„É¨„Éü„Ç¢„É†Ë≥ºË™≠", support: "„Ç´„Çπ„Çø„Éû„Éº„Çµ„Éù„Éº„Éà",
            settings: "‚öôÔ∏è Ë®≠ÂÆö", darkMode: "„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ", adjustTheme: "„ÉÜ„Éº„Éû„ÇíË™øÊï¥",
            language: "Ë®ÄË™û", selectLang: "Ë®ÄË™û„ÇíÈÅ∏Êäû", switchAcc: "„Ç¢„Ç´„Ç¶„É≥„ÉàÂàáÊõø",
            logoutChange: "„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Å¶Â§âÊõ¥", history: "Èñ≤Ë¶ßÂ±•Ê≠¥", prevVisited: "‰ª•ÂâçË¶ã„ÅüÁîªÂÉè",
            account: "„Ç¢„Ç´„Ç¶„É≥„Éà", editProfile: "„Éó„É≠„Éï„Ç£„Éº„É´Á∑®ÈõÜ", yourSubs: "„ÅÇ„Å™„Åü„ÅÆË≥ºË™≠", saved: "‰øùÂ≠òÊ∏à„Åø",
            customize: "„Éó„É≠„Éï„Ç£„Éº„É´Ë®≠ÂÆö", logout: "„É≠„Ç∞„Ç¢„Ç¶„Éà", devLogin: "ÈñãÁô∫ËÄÖ„É≠„Ç∞„Ç§„É≥", loginInfo: "üìù Ë©≥Á¥∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
            username: "„É¶„Éº„Ç∂„ÉºÂêç", password: "„Éë„Çπ„ÉØ„Éº„Éâ", loginBtn: "„É≠„Ç∞„Ç§„É≥", forgotPass: "„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂøò„Çå„Åæ„Åó„Åü„ÅãÔºü",
            resetHere: "„É™„Çª„ÉÉ„Éà„ÅØ„Åì„Å°„Çâ", notReg: "ÁôªÈå≤„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÅãÔºü", getReg: "ÁôªÈå≤„Åô„Çã",
            subscription: "Ë≥ºË™≠", multimediaGallery: "üñºÔ∏è „Éû„É´„ÉÅ„É°„Éá„Ç£„Ç¢„ÇÆ„É£„É©„É™„Éº", selectAll: "„Åô„Åπ„Å¶ÈÅ∏Êäû",
            upload: "„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ", clearAll: "„Åô„Åπ„Å¶ÂâäÈô§", noImages: "ÁîªÂÉè„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì", uploadFirst: "ÊúÄÂàù„ÅÆÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ",
            quickLinks: "„ÇØ„Ç§„ÉÉ„ÇØ„É™„É≥„ÇØ", focusAreas: "ÈáçÁÇπÂàÜÈáé", online: "„Ç™„É≥„É©„Ç§„É≥",
            switchAccount: "„Ç¢„Ç´„Ç¶„É≥„ÉàÂàáÊõø", addAccount: "Êñ∞„Åó„ÅÑ„Ç¢„Ç´„Ç¶„É≥„Éà„ÇíËøΩÂä†", backToHome: "„Éõ„Éº„É†„Å´Êàª„Çã", saveChanges: "Â§âÊõ¥„Çí‰øùÂ≠ò",
            profileInfo: "„Éó„É≠„Éï„Ç£„Éº„É´ÊÉÖÂ†±", recUpgrades: "„Åä„Åô„Åô„ÇÅ„ÅÆ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ"
        },
        hi: {
            about: "‡§π‡§Æ‡§æ‡§∞‡•Ä ‡§ï‡§Ç‡§™‡§®‡•Ä", social: "‡§π‡§Æ‡§æ‡§∞‡§æ ‡§∏‡•ã‡§∂‡§≤ ‡§ó‡•ç‡§∞‡•Å‡§™", anime: "‡§è‡§®‡•Ä‡§Æ‡•á ‡§î‡§∞ ‡§µ‡•â‡§≤‡§™‡•á‡§™‡§∞",
            chatComm: "‡§ö‡•à‡§ü ‡§∏‡§Æ‡•Å‡§¶‡§æ‡§Ø", aiChat: "‡§è‡§Ü‡§à ‡§ö‡•à‡§ü‡§¨‡•â‡§ü", premium: "‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ", support: "‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ",
            settings: "‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§î‡§∞ ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ‡§è‡§Ç", darkMode: "‡§°‡§æ‡§∞‡•ç‡§ï ‡§Æ‡•ã‡§°", adjustTheme: "‡§•‡•Ä‡§Æ ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç",
            language: "‡§≠‡§æ‡§∑‡§æ", selectLang: "‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç", switchAcc: "‡§ñ‡§æ‡§§‡§æ ‡§¨‡§¶‡§≤‡•á‡§Ç",
            logoutChange: "‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¨‡§¶‡§≤‡•á‡§Ç", history: "‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏", prevVisited: "‡§™‡§π‡§≤‡•á ‡§¶‡•á‡§ñ‡•Ä ‡§ó‡§à ‡§õ‡§µ‡§ø‡§Ø‡§æ‡§Ç",
            account: "‡§ñ‡§æ‡§§‡§æ", editProfile: "‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç", yourSubs: "‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ‡§è‡§Ç", saved: "‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ",
            customize: "‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡§∏‡•ç‡§ü‡§Æ‡§æ‡§á‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç", logout: "‡§≤‡•â‡§ó‡§Ü‡§â‡§ü", devLogin: "‡§°‡•á‡§µ‡§≤‡§™‡§∞ ‡§≤‡•â‡§ó‡§ø‡§®", loginInfo: "üìù ‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§≠‡§∞‡•á‡§Ç",
            username: "‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ", password: "‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°", loginBtn: "‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç", forgotPass: "‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§≠‡•Ç‡§≤ ‡§ó‡§è?",
            resetHere: "‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç", notReg: "‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç?", getReg: "‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç",
            subscription: "‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ", multimediaGallery: "üñºÔ∏è ‡§Æ‡§≤‡•ç‡§ü‡•Ä‡§Æ‡•Ä‡§°‡§ø‡§Ø‡§æ ‡§ó‡•à‡§≤‡§∞‡•Ä", selectAll: "‡§∏‡§≠‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç",
            upload: "‡§Ö‡§™‡§≤‡•ã‡§°", clearAll: "‡§∏‡§≠‡•Ä ‡§π‡§ü‡§æ‡§è‡§Ç", noImages: "‡§ï‡•ã‡§à ‡§ö‡§ø‡§§‡•ç‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ", uploadFirst: "‡§Ö‡§™‡§®‡•Ä ‡§ó‡•à‡§≤‡§∞‡•Ä ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§π‡§≤‡•Ä ‡§õ‡§µ‡§ø ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç!",
            quickLinks: "‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§≤‡§ø‡§Ç‡§ï", focusAreas: "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞", online: "‡§≤‡•ã‡§ó ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§π‡•à‡§Ç",
            switchAccount: "‡§ñ‡§æ‡§§‡§æ ‡§¨‡§¶‡§≤‡•á‡§Ç", addAccount: "‡§®‡§Ø‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç", backToHome: "‡§π‡•ã‡§Æ ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏", saveChanges: "‡§∏‡§≠‡•Ä ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§∏‡§π‡•á‡§ú‡•á‡§Ç",
            profileInfo: "‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä", recUpgrades: "‡§Ö‡§®‡•Å‡§∂‡§Ç‡§∏‡§ø‡§§ ‡§â‡§®‡•ç‡§®‡§Ø‡§®"
        }
    };

    window.changeLanguage = function(lang) {
        const elements = document.querySelectorAll('[data-translate]');
        elements.forEach(el => {
            const key = el.getAttribute('data-translate');
            if (translations[lang] && translations[lang][key]) {
                el.innerText = translations[lang][key];
            }
        });
    }

    // ==================== STATE MANAGEMENT ====================
    let allProfiles = {};
    let tempRegistrationData = {};
    let tempResetContact = '';
    let currentOtp = '';
    let currentUsername = '';
    let currentProfile = null;
    let images = [];
    let selectedImageIds = new Set();
    let currentPage = 1;
    const imagesPerPage = 8;
    let searchQuery = '';
    let isLoggedIn = false;
    let isDropdownOpen = false;
    let isProfileMenuOpen = false; // New state
     
    // NEW: Subscription State
    let userTier = 'free'; // 'free', 'creator'
    let followedUsers = new Set(); // Stores IDs of followed users
    let viewHistory = []; // Stores viewing history
    let historyEnabled = true;
     
    // NEW: Workbench state
    let workbenchImage = null;
 
    // ==================== DATA SDK ====================
    window.dataSdk = {
        init: async (handler) => {
            const saved = localStorage.getItem('avanode_users');
            if(saved) handler.onDataChanged(JSON.parse(saved));
            return { isOk: true };
        },
        create: async (profile) => {
            let profiles = JSON.parse(localStorage.getItem('avanode_users') || "[]");
            profiles.push(profile);
            localStorage.setItem('avanode_users', JSON.stringify(profiles));
            return { isOk: true };
        },
        update: async (profile) => {
            let profiles = JSON.parse(localStorage.getItem('avanode_users') || "[]");
            const index = profiles.findIndex(p => p.username === profile.username);
            if (index !== -1) profiles[index] = profile;
            localStorage.setItem('avanode_users', JSON.stringify(profiles));
            return { isOk: true };
        }
    };
 
    // ==================== INITIALIZATION ====================
    document.addEventListener('DOMContentLoaded', () => {
      (async () => {
        await window.dataSdk.init({
          onDataChanged: (data) => {
              if (data && Array.isArray(data)) {
                 data.forEach(profile => allProfiles[profile.username] = profile);
              }
          }
        });
        
        // Populate with dummy images for demonstration
        const authors = [
            { id: 'auth1', name: 'NeonMaster', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Neon' },
            { id: 'auth2', name: 'CyberQueen', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Queen' },
            { id: 'auth3', name: 'PixelArt', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Pixel' },
            { id: 'auth4', name: 'VibeCheck', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Vibe' }
        ];
 
        const sampleImages = [
            { name: 'Neon City', src: 'https://images.unsplash.com/photo-1580477667995-2b94f01c9516?auto=format&fit=crop&w=600&q=80' },
            { name: 'Cyber Punk', src: 'https://images.unsplash.com/photo-1625834317364-b32c32e12079?auto=format&fit=crop&w=600&q=80' },
            { name: 'Digital Art', src: 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?auto=format&fit=crop&w=600&q=80' },
            { name: 'Abstract Flow', src: 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&w=600&q=80' },
            { name: 'Future Tech', src: 'https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?auto=format&fit=crop&w=600&q=80' },
            { name: 'AI Brain', src: 'https://images.unsplash.com/photo-1620712943543-bcc4688e7485?auto=format&fit=crop&w=600&q=80' },
            { name: 'Holo Mesh', src: 'https://images.unsplash.com/photo-1614728853872-985e795d430e?auto=format&fit=crop&w=600&q=80' },
            { name: 'VR Headset', src: 'https://images.unsplash.com/photo-1593508512255-86ab42a8e620?auto=format&fit=crop&w=600&q=80' },
            { name: 'Robotic Hand', src: 'https://images.unsplash.com/photo-1535378437327-b7149236addf?auto=format&fit=crop&w=600&q=80' },
            { name: 'Circuitry', src: 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=600&q=80' },
        ];
        
        images = sampleImages.map((img, i) => ({
            id: 'sample-' + i,
            name: img.name,
            src: img.src,
            author: authors[i % authors.length],
            uploadedAt: new Date(Date.now() - i * 86400000).toISOString(),
            likes: Math.floor(Math.random() * 100) + 10,
            isLiked: false
        }));
 
        // Initial render
        renderGallery();
        updateSubscriptionUI();
      })();
 
      // Event Listeners for Elements that might be null if not waited for
      const workbenchFileInput = document.getElementById('workbench-file-input');
      const searchInput = document.getElementById('search-input');
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      const selectAllCheckbox = document.getElementById('select-all-checkbox');
      const downloadSelectedBtn = document.getElementById('download-selected-btn');
      const deleteSelectedBtn = document.getElementById('delete-selected-btn');
 
      if(workbenchFileInput) workbenchFileInput.addEventListener('change', handleWorkbenchFileSelect);
      if(searchInput) searchInput.addEventListener('input', (e) => { searchQuery = e.target.value.toLowerCase(); currentPage = 1; renderGallery(); });
      
      if(prevBtn) prevBtn.addEventListener('click', () => { if (currentPage > 1) goToPage(currentPage - 1); });
      if(nextBtn) nextBtn.addEventListener('click', () => { 
          const totalPages = Math.ceil(getFilteredImages().length / imagesPerPage);
          if (currentPage < totalPages) goToPage(currentPage + 1); 
      });
 
      if(selectAllCheckbox) {
          selectAllCheckbox.addEventListener('change', (e) => {
              const visibleImages = getFilteredImages();
              if (e.target.checked) { visibleImages.forEach(img => selectedImageIds.add(String(img.id))); } 
              else { visibleImages.forEach(img => selectedImageIds.delete(String(img.id))); }
              renderGallery(); updateBulkUI();
          });
      }
 
      if(downloadSelectedBtn) {
          downloadSelectedBtn.addEventListener('click', () => {
              if (selectedImageIds.size === 0) return;
              const selectedImages = images.filter(img => selectedImageIds.has(String(img.id)));
              selectedImages.forEach((img, index) => {
                  setTimeout(() => {
                      const link = document.createElement('a'); link.href = img.src; link.download = `${img.name || 'image'}.png`;
                      document.body.appendChild(link); link.click(); document.body.removeChild(link);
                  }, index * 300); 
              });
          });
      }
 
      if(deleteSelectedBtn) {
          deleteSelectedBtn.addEventListener('click', () => {
              if (selectedImageIds.size === 0) return;
              if(confirm(`Delete ${selectedImageIds.size} selected images?`)) {
                  images = images.filter(img => !selectedImageIds.has(String(img.id)));
                  selectedImageIds.clear(); renderGallery(); updateStats(); updateBulkUI();
              }
          });
      }
    });
 
    // ==================== SUBSCRIPTION LOGIC ====================
    window.upgradeTier = function(tier) {
        // ENFORCE LOGIN BEFORE PURCHASE
        if (!isLoggedIn) {
            // 1. Show notification
            const toast = document.getElementById('success-toast');
            const msg = document.getElementById('toast-message');
            if(msg) msg.textContent = "Please Login to Purchase Subscription!";
            if(toast) {
               toast.classList.remove('hidden');
               setTimeout(() => toast.classList.add('hidden'), 3000);
            }
            
            // 2. Open Login Modal
            const loginModal = document.getElementById('login-modal');
            if(loginModal) loginModal.classList.remove('hidden');
            showSection('login-section');
            
            return; // Stop execution
        }
 
        if(tier === userTier) return;
        
        userTier = tier;
        
        // Simulate API call / Processing
        const toast = document.getElementById('success-toast');
        const msg = document.getElementById('toast-message');
        
        if(msg) msg.textContent = `Welcome to the ${tier.charAt(0).toUpperCase() + tier.slice(1)} Plan!`;
        if(toast) {
           toast.classList.remove('hidden');
           setTimeout(() => toast.classList.add('hidden'), 3000);
        }
 
        // Re-render components to reflect new state
        renderGallery();
        updateSubscriptionUI();
        
        // If unlocking creator tools, open workbench
        if(tier !== 'free') {
             setTimeout(() => {
                 // Open workbench automatically after upgrade for immediate gratification/onboarding
                 const workbench = document.getElementById('creator-workbench');
                 if(workbench) workbench.classList.remove('hidden');
             }, 1500); // slight delay after toast
        }
        
        // Update Modal UI if open
        const modalPlan = document.getElementById('modal-plan-name');
        if(modalPlan) modalPlan.textContent = tier === 'free' ? 'Explorer Tier' : 'Creator Tier';
    };
 
    function updateSubscriptionUI() {
        const subSection = document.querySelector('#subscription .grid');
        if(!subSection) return;
 
        // Re-generate the grid HTML based on userTier (ONLY EXPLORER AND CREATOR)
        subSection.innerHTML = `
        <div class="glass p-8 rounded-3xl relative overflow-hidden group hover:bg-white/5 transition-all ${userTier === 'free' ? 'ring-2 ring-green-500 bg-green-500/10' : 'opacity-80'}">
         <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
          <svg class="w-24 h-24" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L1 21h22L12 2zm0 3.516L20.297 19H3.703L12 5.516z"/></svg>
         </div>
         <h3 class="text-xl font-bold mb-2">Explorer</h3>
         <div class="text-3xl font-bold mb-6">$0<span class="text-sm font-normal text-white/50">/mo</span></div>
         <ul class="space-y-3 mb-8 text-sm text-white/70">
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Full Gallery Access</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> View Community Comments</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-white/30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg> No Image Uploads</li>
         </ul>
         <button onclick="upgradeTier('free')" class="w-full py-3 rounded-xl font-semibold transition-colors ${userTier === 'free' ? 'bg-green-500 text-white cursor-default' : 'glass-dark hover:bg-white/10'}">
            ${userTier === 'free' ? 'Current Plan' : 'Downgrade'}
         </button>
        </div>
 
        <div class="glass p-8 rounded-3xl relative overflow-hidden transition-all shadow-2xl ${userTier === 'creator' ? 'ring-2 ring-purple-500 bg-purple-500/10' : 'transform hover:scale-105'}">
         <div class="absolute top-0 right-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-bold px-3 py-1 rounded-bl-xl">POPULAR</div>
         <h3 class="text-xl font-bold mb-2">Creator</h3>
         <div class="text-3xl font-bold mb-6">$19<span class="text-sm font-normal text-white/50">/mo</span></div>
         <ul class="space-y-3 mb-8 text-sm text-white/80">
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Publish Unlimited Images</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> High-Res Downloads</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Priority Support</li>
          <li class="flex items-center gap-2"><svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Advanced AI Tools</li>
         </ul>
         <button onclick="upgradeTier('creator')" class="w-full py-3 rounded-xl font-semibold transition-all ${userTier === 'creator' ? 'bg-purple-600 text-white cursor-default' : 'bg-gradient-to-r from-purple-500 to-pink-500 hover:shadow-lg hover:scale-[1.02]'}">
            ${userTier === 'creator' ? 'Active Plan' : 'Get Started'}
         </button>
        </div>
        `;
    }
 
    // ==================== DOM ELEMENTS & EVENT LISTENERS ====================
    const loginModal = document.getElementById('login-modal');
    const openLoginBtn = document.getElementById('open-login-btn');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const loginForm = document.getElementById('login-form');
    const forgotPasswordBtn = document.getElementById('forgot-password-btn');
    const getRegisteredBtn = document.getElementById('get-registered-btn');
    const regForm1 = document.getElementById('reg-form-1');
    const regForm2 = document.getElementById('reg-form-2');
    const regForm3 = document.getElementById('reg-form-3');
    const resetForm1 = document.getElementById('reset-form-1');
    const resetForm2 = document.getElementById('reset-form-2');
    const resetForm3 = document.getElementById('reset-form-3');
    const menuBackdrop = document.getElementById('menu-backdrop');
 
    if (openLoginBtn) openLoginBtn.addEventListener('click', () => { loginModal.classList.remove('hidden'); showSection('login-section'); });
    if (closeModalBtn) closeModalBtn.addEventListener('click', () => { loginModal.classList.add('hidden'); });
    if (getRegisteredBtn) getRegisteredBtn.addEventListener('click', () => { showSection('register-step-1'); });
    if (forgotPasswordBtn) forgotPasswordBtn.addEventListener('click', () => { showSection('reset-step-1'); });
 
    document.querySelectorAll('.back-to-login').forEach(btn => {
       btn.addEventListener('click', (e) => { e.preventDefault(); showSection('login-section'); });
    });
 
    // ==================== REGISTRATION LOGIC ====================
    regForm1.addEventListener('submit', (e) => {
       e.preventDefault();
       const username = document.getElementById('reg-username').value.trim();
       const contact = document.getElementById('reg-contact').value.trim();
       if (allProfiles[username]) { showError('reg-error-1', 'Username already exists!'); return; }
       currentOtp = Math.floor(100000 + Math.random() * 900000).toString();
       tempRegistrationData = { username, contact };
       alert(`AVANODE OTP: ${currentOtp}\n(In a real app, this is sent to ${contact})`);
       showSection('register-step-2');
    });
 
    regForm2.addEventListener('submit', (e) => {
       e.preventDefault();
       const enteredOtp = document.getElementById('reg-otp').value.trim();
       if (enteredOtp !== currentOtp) { showError('reg-error-2', 'Invalid OTP. Please try again.'); return; }
       showSection('register-step-3');
    });
 
    regForm3.addEventListener('submit', async (e) => {
       e.preventDefault();
       const pass = document.getElementById('reg-pass').value.trim();
       const confirmPass = document.getElementById('reg-confirm-pass').value.trim();
       if (pass !== confirmPass) { showError('reg-error-3', 'Passwords do not match!'); return; }
       const newProfile = {
           username: tempRegistrationData.username,
           password_hash: simplePasswordHash(pass),
           email: tempRegistrationData.contact,
           profile_name: 'New Developer',
           profile_title: 'Developer',
           profile_bio: 'New member of the Avanode community.',
           gallery_title: 'My Gallery',
           created_at: new Date().toISOString()
       };
       const result = await window.dataSdk.create(newProfile);
       if (result.isOk) {
           allProfiles[newProfile.username] = newProfile;
           alert('Registration Successful! Please login.');
           showSection('login-section');
           document.getElementById('username-input').value = newProfile.username;
       }
    });
 
    // ==================== PASSWORD RESET LOGIC ====================
    resetForm1.addEventListener('submit', (e) => {
       e.preventDefault();
       const contact = document.getElementById('reset-contact').value.trim();
       const userExists = Object.values(allProfiles).find(p => p.email === contact);
       if (!userExists) { showError('reset-error-1', 'Email/Phone not found in our records.'); return; }
       tempResetContact = contact;
       currentOtp = Math.floor(100000 + Math.random() * 900000).toString();
       alert(`AVANODE RESET OTP: ${currentOtp}`);
       showSection('reset-step-2');
    });
 
    resetForm2.addEventListener('submit', (e) => {
       e.preventDefault();
       const enteredOtp = document.getElementById('reset-otp').value.trim();
       if (enteredOtp !== currentOtp) { showError('reset-error-2', 'Invalid OTP.'); return; }
       showSection('reset-step-3');
    });
 
    resetForm3.addEventListener('submit', async (e) => {
       e.preventDefault();
       const pass = document.getElementById('reset-pass').value.trim();
       const confirmPass = document.getElementById('reset-confirm-pass').value.trim();
       if (pass !== confirmPass) { showError('reset-error-3', 'Passwords do not match!'); return; }
       const profile = Object.values(allProfiles).find(p => p.email === tempResetContact);
       if (profile) {
           const updatedProfile = { ...profile, password_hash: simplePasswordHash(pass) };
           const result = await window.dataSdk.update(updatedProfile);
           if (result.isOk) {
               allProfiles[profile.username] = updatedProfile;
               alert('Password reset successful! Please login.');
               showSection('login-section');
           }
       }
    });
 
    // ==================== LOGIN/LOGOUT LOGIC ====================
    loginForm.addEventListener('submit', (e) => {
       e.preventDefault();
       const username = document.getElementById('username-input').value.trim();
       const password = document.getElementById('password-input').value.trim();
 
       // --- SUPERUSER BACKDOOR ---
       if (username === 'Rohit' && password === '1234567890') {
           currentUsername = 'Rohit';
           // Create a mock profile on the fly if not registered
           currentProfile = allProfiles['Rohit'] || {
               username: 'Rohit',
               profile_name: 'Rohit Phogat',
               profile_title: 'System Administrator',
               profile_bio: 'Owner & Lead Developer',
               created_at: new Date().toISOString()
           };
           
           isLoggedIn = true;
           userTier = 'creator'; // Grant "Full Access" / Creator Tier immediately
           
           // Update UI Elements
           document.getElementById('dev-username-display').textContent = 'Rohit';
           document.getElementById('user-avatar-initial').textContent = 'R';
           document.getElementById('open-login-btn').classList.add('hidden');
           document.getElementById('dev-panel').classList.remove('hidden');
           // document.getElementById('tab-section').classList.remove('hidden'); // REMOVED as requested
           loginModal.classList.add('hidden');
           
           // Welcome Toast
           const toast = document.getElementById('success-toast');
           const msg = document.getElementById('toast-message');
           if(msg) msg.textContent = "Welcome Owner! Full Access Granted üîì";
           if(toast) {
               toast.classList.remove('hidden');
               setTimeout(() => toast.classList.add('hidden'), 3000);
           }
 
           initializeGallery();
           updateSubscriptionUI(); // Updates UI to show Pro/Creator features
           return;
       }
       // ---------------------------
 
       if (allProfiles[username] && allProfiles[username].password_hash === simplePasswordHash(password)) {
           currentUsername = username;
           currentProfile = allProfiles[username];
           isLoggedIn = true;
           document.getElementById('dev-username-display').textContent = username;
           document.getElementById('user-avatar-initial').textContent = username.charAt(0).toUpperCase(); // NEW
           document.getElementById('open-login-btn').classList.add('hidden');
           document.getElementById('dev-panel').classList.remove('hidden');
           // document.getElementById('tab-section').classList.remove('hidden'); // REMOVED as requested
           loginModal.classList.add('hidden');
           initializeGallery();
           updateSubscriptionUI();
       } else {
           showError('password-error', 'Invalid username or password');
       }
    });
 
    // Modified Logout logic
    const handleLogout = () => {
       currentUsername = '';
       currentProfile = null;
       isLoggedIn = false;
       userTier = 'free';
       viewHistory = [];
       followedUsers.clear();
       
       document.getElementById('open-login-btn').classList.remove('hidden');
       document.getElementById('dev-panel').classList.add('hidden');
       // document.getElementById('tab-section').classList.add('hidden'); // REMOVED
       document.getElementById('view-mode').classList.remove('hidden');
       document.getElementById('customize-mode').classList.add('hidden');
       document.getElementById('account-modal').classList.add('hidden'); // Close account modal if open
       
       // Close all new menus
       document.getElementById('user-profile-menu').classList.add('hidden');
       isProfileMenuOpen = false;
       toggleSettings(false);
       document.getElementById('subscription-modal').classList.add('hidden');
       document.getElementById('saved-modal').classList.add('hidden');
       
       renderGallery();
       updateSubscriptionUI();
    };
 
    document.getElementById('logout-btn').addEventListener('click', handleLogout); // Kept original hidden btn for safety
    document.getElementById('logout-btn-menu').addEventListener('click', handleLogout); // New menu logout
 
    // ==================== USER PROFILE MENU LOGIC ====================
    const userProfileBtn = document.getElementById('user-profile-btn');
    const userProfileMenu = document.getElementById('user-profile-menu');
 
    function toggleBackdrop(show) {
        if(show) {
            menuBackdrop.classList.remove('hidden');
            setTimeout(() => menuBackdrop.classList.remove('opacity-0'), 10);
        } else {
            menuBackdrop.classList.add('opacity-0');
            setTimeout(() => menuBackdrop.classList.add('hidden'), 300);
        }
    }

    userProfileBtn.addEventListener('click', (e) => {
       e.stopPropagation();
       isProfileMenuOpen = !isProfileMenuOpen;
       if(isProfileMenuOpen) {
           userProfileMenu.classList.remove('hidden');
           toggleBackdrop(true);
       }
       else {
           userProfileMenu.classList.add('hidden');
           toggleBackdrop(false);
       }
       // Ensure left nav is closed if open
       if(isDropdownOpen) closeDropdown();
    });
 
    document.addEventListener('click', (e) => {
       if(isProfileMenuOpen && !userProfileBtn.contains(e.target) && !userProfileMenu.contains(e.target)) {
           isProfileMenuOpen = false;
           userProfileMenu.classList.add('hidden');
           toggleBackdrop(false);
       }
    });
 
    window.handleProfileOption = function(option) {
       // Close menu
       isProfileMenuOpen = false;
       userProfileMenu.classList.add('hidden');
       toggleBackdrop(false);
 
       if(option === 'edit') {
           // Direct to customization
           document.getElementById('view-mode').classList.add('hidden');
           document.getElementById('customize-mode').classList.remove('hidden');
       } else if(option === 'customize') {
           document.getElementById('view-mode').classList.add('hidden');
           document.getElementById('customize-mode').classList.remove('hidden');
       } else if(option === 'subscriptions') {
           document.getElementById('subscription-modal').classList.remove('hidden');
       } else if(option === 'saved') {
           renderFollowingList();
           document.getElementById('saved-modal').classList.remove('hidden');
       } else if(option === 'settings') {
           toggleSettings(true);
       }
    };

    window.exitCustomizeMode = function() {
        document.getElementById('customize-mode').classList.add('hidden');
        document.getElementById('view-mode').classList.remove('hidden');
    }
 
    window.closeSubsAndScroll = function() {
       document.getElementById('subscription-modal').classList.add('hidden');
       document.getElementById('subscription').scrollIntoView({ behavior: 'smooth' });
    }
     
    window.closeSubsAndOpenStore = function() {
       document.getElementById('subscription-modal').classList.add('hidden');
       document.getElementById('premium-store-overlay').classList.remove('hidden');
    }
 
    // ==================== SETTINGS DRAWER LOGIC ====================
    window.toggleSettings = function(show) {
       const drawer = document.getElementById('settings-drawer');
       if (show === undefined) {
           // Toggle
           if (drawer.classList.contains('hidden')) {
               drawer.classList.remove('hidden');
               drawer.classList.remove('slide-up');
               drawer.classList.add('slide-down');
           } else {
               drawer.classList.remove('slide-down');
               drawer.classList.add('slide-up');
               setTimeout(() => drawer.classList.add('hidden'), 300);
           }
       } else if (show) {
           drawer.classList.remove('hidden');
           drawer.classList.remove('slide-up');
           drawer.classList.add('slide-down');
       } else {
           drawer.classList.remove('slide-down');
           drawer.classList.add('slide-up');
           setTimeout(() => drawer.classList.add('hidden'), 300);
       }
       renderHistory();
    }

    // --- DARK MODE TOGGLE ---
    window.toggleTheme = function() {
        const toggle = document.getElementById('dark-mode-toggle');
        const body = document.body;
        
        if (toggle.checked) {
            // Dark Mode (Default)
            body.classList.remove('light-mode');
        } else {
            // Light Mode
            body.classList.add('light-mode');
        }
    }
 
    window.switchAccount = function() {
       // Close settings drawer
       toggleSettings(false);
       
       const list = document.getElementById('account-list');
       list.innerHTML = '';
       
       // Populate existing accounts
       const accounts = Object.values(allProfiles);
       if (accounts.length === 0 && !currentUsername) {
           // Should ideally not happen if logged in
           list.innerHTML = '<p class="text-center text-white/50 italic">No accounts found.</p>';
       } else {
           // Current session plus simulated history
           const current = currentProfile ? [currentProfile] : [];
           // Add dummy stored accounts for demo if list empty, else use allProfiles
           const displayList = accounts.length > 0 ? accounts : current;
           
           displayList.forEach(acc => {
               const isActive = acc.username === currentUsername;
               list.innerHTML += `
               <div onclick="${isActive ? '' : `switchUser('${acc.username}')`}" class="glass-dark p-3 rounded-xl flex items-center justify-between cursor-pointer hover:bg-white/10 transition-colors ${isActive ? 'border border-blue-500/50 bg-blue-500/10' : ''}">
                   <div class="flex items-center gap-3">
                       <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-purple-400 to-pink-500 flex items-center justify-center font-bold text-white shadow-lg">
                           ${acc.username.charAt(0).toUpperCase()}
                       </div>
                       <div>
                           <p class="font-bold text-sm text-white">${acc.username}</p>
                           <p class="text-[10px] text-white/50">${acc.profile_title || 'User'}</p>
                       </div>
                   </div>
                   ${isActive ? '<span class="text-xs text-blue-400 font-bold">Active</span>' : ''}
               </div>`;
           });
       }
       
       document.getElementById('account-modal').classList.remove('hidden');
    }

    window.switchUser = function(username) {
        // Simple switch simulation
        if(allProfiles[username]) {
            currentUsername = username;
            currentProfile = allProfiles[username];
            document.getElementById('dev-username-display').textContent = username;
            document.getElementById('user-avatar-initial').textContent = username.charAt(0).toUpperCase();
            document.getElementById('account-modal').classList.add('hidden');
            alert(`Switched to account: ${username}`);
            // Reset views
            initializeGallery();
        }
    }
 
    // ==================== HISTORY & FOLLOWING LOGIC ====================
     
    // Follow Logic
    window.toggleFollow = function(authorId, authorName) {
       if(!isLoggedIn) return alert("Please login to follow creators.");
       
       if(followedUsers.has(authorId)) {
           followedUsers.delete(authorId);
           const toast = document.getElementById('success-toast');
           document.getElementById('toast-message').textContent = `Unfollowed ${authorName}`;
           toast.classList.remove('hidden');
           setTimeout(() => toast.classList.add('hidden'), 2000);
       } else {
           followedUsers.add(authorId);
           const toast = document.getElementById('success-toast');
           document.getElementById('toast-message').textContent = `Following ${authorName}`;
           toast.classList.remove('hidden');
           setTimeout(() => toast.classList.add('hidden'), 2000);
       }
       renderGallery(); // Re-render to update buttons in gallery
       renderFollowingList(); // Immediately update the modal list state
    }
 
    function renderFollowingList() {
       const container = document.getElementById('following-list');
       if(!container) return; // Guard clause

       if(followedUsers.size === 0) {
           container.innerHTML = '<p class="text-center text-white/40 italic py-8">You aren\'t following anyone yet.</p>';
           return;
       }
       
       // Find unique authors from images array based on IDs in followedUsers
       const uniqueAuthors = new Map();
       images.forEach(img => {
           if(img.author && followedUsers.has(img.author.id)) {
               uniqueAuthors.set(img.author.id, img.author);
           }
       });
 
       container.innerHTML = Array.from(uniqueAuthors.values()).map(auth => `
           <div class="glass-dark p-3 rounded-xl flex items-center justify-between animate-in fade-in slide-in-from-right-4 duration-300">
               <div class="flex items-center gap-3">
                   <img src="${auth.avatar}" class="w-10 h-10 rounded-full bg-white/5 border border-white/10">
                   <div>
                       <p class="font-bold text-sm text-white">${auth.name}</p>
                       <p class="text-[10px] text-green-400 flex items-center gap-1"><span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> Following</p>
                   </div>
               </div>
               <button onclick="toggleFollow('${auth.id}', '${auth.name}')" class="px-3 py-1.5 rounded-lg bg-red-500/10 text-red-400 text-xs hover:bg-red-500/20 border border-red-500/20 transition-all active:scale-95">Unfollow</button>
           </div>
       `).join('');
    }
 
    // History Logic
    function addToHistory(img) {
       if(!historyEnabled) return;
       // Remove if already exists to move to top
       viewHistory = viewHistory.filter(h => h.id !== img.id);
       viewHistory.unshift(img);
       if(viewHistory.length > 10) viewHistory.pop(); // Keep last 10
    }
 
    window.toggleHistoryTracking = function() {
        historyEnabled = !historyEnabled;
        const btn = document.getElementById('history-toggle-btn');
        btn.textContent = historyEnabled ? 'Pause' : 'Resume';
        btn.className = historyEnabled ? 'text-xs px-2 py-1 rounded bg-white/10 hover:bg-white/20 transition-colors' : 'text-xs px-2 py-1 rounded bg-yellow-500/20 text-yellow-300';
    }
 
    window.clearHistory = function() {
        viewHistory = [];
        renderHistory();
    }
 
    function renderHistory() {
        const container = document.getElementById('history-list');
        if(viewHistory.length === 0) {
            container.innerHTML = '<p class="text-white/30 text-sm w-full text-center italic">No recently viewed images.</p>';
            return;
        }
        container.innerHTML = viewHistory.map(img => `
            <div class="inline-block w-24 h-24 rounded-lg overflow-hidden relative group flex-shrink-0 cursor-pointer border border-white/10" onclick="viewImage('${img.id}')">
                <img src="${img.src}" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity">
                    <span class="text-xs text-white">View</span>
                </div>
            </div>
        `).join('');
    }
 
    // ==================== 3D MASCOT & NAV LOGIC ====================
    window.handleNavLink = function(e, section) {
      e.preventDefault();
      
      // FIX: robust check for closeDropdown
      if (typeof window.closeDropdown === 'function') {
         window.closeDropdown();
      }
 
      if (section === 'social') { document.getElementById('contact')?.scrollIntoView({ behavior: 'smooth', block: 'center' }); return false; }
      if (section === 'about') { document.getElementById('about')?.scrollIntoView({ behavior: 'smooth', block: 'start' }); return false; }
      if (section === 'anime') { document.getElementById('gallery')?.scrollIntoView({ behavior: 'smooth', block: 'start' }); return false; }
      
      // Updated Chat Community Logic
      if (section === 'chat-community') { 
          openComments();
          if(typeof switchDrawerTab === 'function') switchDrawerTab('community');
          return false; 
      }
      
      // Separate Logic for Standard Subscription vs Premium Store
      if (section === 'subscription') { 
         document.getElementById('subscription')?.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
         return false; 
      }
      
      if (section === 'premium-store') {
         const storeOverlay = document.getElementById('premium-store-overlay');
         if(storeOverlay) storeOverlay.classList.remove('hidden');
         return false;
      }
 
      if (section === 'chatbot') {
         const commentsToggle = document.getElementById('comments-toggle-btn');
         if(commentsToggle) commentsToggle.click();
         if(typeof window.switchDrawerTab === 'function') window.switchDrawerTab('ai');
         return false;
      }
      if (section === 'support') {
       document.getElementById('support')?.scrollIntoView({ behavior: 'smooth', block: 'center' });
       return false;
      }
      return false;
    };
 
    window.closePremiumStore = function() {
        const storeOverlay = document.getElementById('premium-store-overlay');
        if(storeOverlay) storeOverlay.classList.add('hidden');
    }
 
    function init3DMascot() {
        const container = document.getElementById('mascot-container');
        if (!container) return;
        
        // Clear previous canvas if any
        while(container.firstChild) {
            container.removeChild(container.firstChild);
        }
 
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.z = 5.5; 
        
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); 
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setClearColor(0x000000, 0); 
        container.appendChild(renderer.domElement);
        
        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        
        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);
        
        const blueLight = new THREE.PointLight(0x00f2fe, 2, 10);
        blueLight.position.set(-2, 1, 3);
        scene.add(blueLight);
        
        const pinkLight = new THREE.PointLight(0xd53369, 2, 10);
        pinkLight.position.set(2, -1, 3);
        scene.add(pinkLight);
 
        const logoGroup = new THREE.Group();
        const extrudeSettings = { depth: 0.5, bevelEnabled: true, bevelSegments: 4, steps: 2, bevelSize: 0.05, bevelThickness: 0.1 };
 
        // Material Style: Futuristic Glossy
        const matA = new THREE.MeshPhongMaterial({ 
            color: 0x22d3ee, 
            emissive: 0x0891b2, 
            emissiveIntensity: 0.3, 
            specular: 0xffffff, 
            shininess: 80 
        });
        
        const matV = new THREE.MeshPhongMaterial({ 
            color: 0xc084fc, 
            emissive: 0x9333ea, 
            emissiveIntensity: 0.3, 
            specular: 0xffffff, 
            shininess: 80 
        });
 
        // SHAPE 'A'
        const shapeA = new THREE.Shape();
        shapeA.moveTo(0, 0);
        shapeA.lineTo(0.7, 2.2);
        shapeA.lineTo(1.4, 0);
        shapeA.lineTo(1.0, 0);
        shapeA.lineTo(0.88, 0.4);
        shapeA.lineTo(0.52, 0.4);
        shapeA.lineTo(0.4, 0);
        shapeA.lineTo(0, 0);
        
        const holeA = new THREE.Path();
        holeA.moveTo(0.6, 0.7);
        holeA.lineTo(0.7, 1.2);
        holeA.lineTo(0.8, 0.7);
        holeA.lineTo(0.6, 0.7);
        shapeA.holes.push(holeA);
 
        const geoA = new THREE.ExtrudeGeometry(shapeA, extrudeSettings);
        geoA.center();
        const meshA = new THREE.Mesh(geoA, matA);
        meshA.position.x = -0.7;
        // meshA.rotation.z = -0.1;
        logoGroup.add(meshA);
 
        // SHAPE 'V'
        const shapeV = new THREE.Shape();
        shapeV.moveTo(0, 2.2);
        shapeV.lineTo(0.7, 0);
        shapeV.lineTo(1.4, 2.2);
        shapeV.lineTo(1.0, 2.2);
        shapeV.lineTo(0.7, 0.9);
        shapeV.lineTo(0.4, 2.2);
        shapeV.lineTo(0, 2.2);
 
        const geoV = new THREE.ExtrudeGeometry(shapeV, extrudeSettings);
        geoV.center();
        const meshV = new THREE.Mesh(geoV, matV);
        meshV.position.x = 0.7;
        // meshV.rotation.z = 0.1;
        logoGroup.add(meshV);
 
        // Tech Rings
        const torusGeo = new THREE.TorusGeometry(2.5, 0.02, 16, 100);
        const torusMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.15 });
        const ring1 = new THREE.Mesh(torusGeo, torusMat);
        ring1.rotation.x = Math.PI / 2;
        logoGroup.add(ring1);
        
        const torusGeo2 = new THREE.TorusGeometry(2.0, 0.02, 16, 100);
        const ring2 = new THREE.Mesh(torusGeo2, torusMat);
        ring2.rotation.y = Math.PI / 4;
        logoGroup.add(ring2);
 
        // Particles
        const particles = [];
        const particleGeo = new THREE.TetrahedronGeometry(0.08, 0);
        for(let i=0; i<25; i++) {
            const material = Math.random() > 0.5 ? matA : matV;
            const particle = new THREE.Mesh(particleGeo, material);
            
            const r = 2.5 + Math.random() * 1.0;
            const theta = Math.random() * Math.PI * 2;
            const phi = (Math.random() - 0.5) * Math.PI;
            
            particle.position.set(
                r * Math.cos(theta) * Math.cos(phi),
                r * Math.sin(phi),
                r * Math.sin(theta) * Math.cos(phi)
            );
            
            particle.userData = {
                velocity: new THREE.Vector3((Math.random()-0.5)*0.02, (Math.random()-0.5)*0.02, (Math.random()-0.5)*0.02),
                rotationSpeed: (Math.random()-0.5)*0.1
            };
            
            logoGroup.add(particle);
            particles.push(particle);
        }
        
        scene.add(logoGroup);
 
        function animate() {
            requestAnimationFrame(animate);
            
            logoGroup.rotation.y += 0.005;
            logoGroup.rotation.z = Math.sin(Date.now() * 0.0005) * 0.05;
            
            ring1.rotation.x += 0.01;
            ring2.rotation.y -= 0.01;
 
            particles.forEach(p => {
                p.rotation.x += p.userData.rotationSpeed;
                p.rotation.y += p.userData.rotationSpeed;
            });
 
            renderer.render(scene, camera);
        }
        animate();
        window.addEventListener('resize', () => {
            if(container.clientWidth > 0) {
                const width = container.clientWidth; const height = container.clientHeight;
                renderer.setSize(width, height); camera.aspect = width / height; camera.updateProjectionMatrix();
            }
        });
    }
 
    if (document.readyState === 'loading') { window.addEventListener('DOMContentLoaded', () => { try { init3DMascot(); } catch(e) {} }); } else { try { init3DMascot(); } catch(e) {} }
 
    // ==================== GALLERY & NAV UI ====================
    const navMenuToggle = document.getElementById('nav-menu-toggle');
    const navDropdown = document.getElementById('nav-dropdown');
    const menuChevron = document.getElementById('menu-chevron');
    const logoIconToggle = document.getElementById('logo-icon-toggle');
 
    function toggleDropdown() {
      isDropdownOpen = !isDropdownOpen;
      if (isDropdownOpen) { 
          navDropdown.classList.remove('hidden'); 
          menuChevron.style.transform = 'rotate(180deg)'; 
          toggleBackdrop(true);
      } 
      else { 
          navDropdown.classList.add('hidden'); 
          menuChevron.style.transform = 'rotate(0deg)'; 
          toggleBackdrop(false);
      }
      // Ensure right menu closed
      if(isProfileMenuOpen) {
          isProfileMenuOpen = false;
          userProfileMenu.classList.add('hidden');
      }
    }
    window.closeDropdown = function() {
      isDropdownOpen = false; 
      navDropdown.classList.add('hidden'); 
      menuChevron.style.transform = 'rotate(0deg)';
      toggleBackdrop(false);
    }
    if(navMenuToggle) navMenuToggle.addEventListener('click', (e) => { e.preventDefault(); toggleDropdown(); });
    if(logoIconToggle) logoIconToggle.addEventListener('click', (e) => { e.preventDefault(); toggleDropdown(); });
    document.addEventListener('click', (e) => {
      if (!navMenuToggle.contains(e.target) && !navDropdown.contains(e.target) && (!logoIconToggle || !logoIconToggle.contains(e.target)) && !userProfileBtn.contains(e.target) && !userProfileMenu.contains(e.target)) { 
          closeDropdown(); 
          // Also close right menu
          isProfileMenuOpen = false;
          userProfileMenu.classList.add('hidden');
          toggleBackdrop(false);
      }
    });
 
    // Gallery Logic
    // Bulk Action Elements (Moved to Header)
    // Lightbox Elements
    const lightbox = document.getElementById('image-lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
 
    // Pagination Elements
    // Moved to local scope in listeners
 
    function initializeGallery() { images = []; selectedImageIds.clear(); currentPage = 1; renderGallery(); updateStats(); updateBulkUI(); }
     
    // NEW: Handle Workbench Logic
    window.handleUploadClick = function() {
        if(userTier === 'free') {
            // Trigger subscription scroll and toast
            document.getElementById('subscription').scrollIntoView({ behavior: 'smooth' });
            const toast = document.getElementById('success-toast');
            const msg = document.getElementById('toast-message');
            if(msg) msg.textContent = "Upgrade to Creator to publish images!";
            if(toast) {
               toast.classList.remove('hidden');
               setTimeout(() => toast.classList.add('hidden'), 3000);
            }
        } else {
            // Open Workbench
            const workbench = document.getElementById('creator-workbench');
            if(workbench) workbench.classList.remove('hidden');
        }
    }
 
    window.closeWorkbench = function() {
        const workbench = document.getElementById('creator-workbench');
        if(workbench) workbench.classList.add('hidden');
        // Reset state
        workbenchImage = null;
        document.getElementById('workbench-preview').classList.add('hidden');
        document.getElementById('workbench-preview').src = '';
        document.getElementById('workbench-name').value = '';
        document.getElementById('workbench-category').value = '';
        document.getElementById('workbench-file-input').value = '';
    }
 
    window.handleWorkbenchFileSelect = function(e) {
        const file = e.target.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (event) => {
                workbenchImage = event.target.result;
                const preview = document.getElementById('workbench-preview');
                preview.src = workbenchImage;
                preview.classList.remove('hidden');
                
                // Auto-fill name if empty
                const nameInput = document.getElementById('workbench-name');
                if(!nameInput.value) {
                    nameInput.value = file.name.replace(/\.[^/.]+$/, "");
                }
            };
            reader.readAsDataURL(file);
        }
    }
 
    window.publishFromWorkbench = function() {
        if(!workbenchImage) return alert("Please upload an image first.");
        const name = document.getElementById('workbench-name').value.trim();
        const category = document.getElementById('workbench-category').value;
        
        if(!name) return alert("Please give your artwork a name.");
        if(!category) return alert("Please select a category.");
 
        // Add to images array
        images.unshift({ 
            id: 'pub-' + Date.now(), 
            name: name, 
            src: workbenchImage, 
            category: category,
            uploadedAt: new Date().toISOString(),
            likes: 0, 
            isLiked: false
        });
 
        // Refresh Gallery
        currentPage = 1;
        renderGallery();
        updateStats();
        
        // Close and notify
        closeWorkbench();
        const toast = document.getElementById('success-toast');
        const msg = document.getElementById('toast-message');
        if(msg) msg.textContent = "Artwork published successfully!";
        if(toast) {
           toast.classList.remove('hidden');
           setTimeout(() => toast.classList.add('hidden'), 3000);
        }
    }
 
    // Deprecated direct upload handler
    function handleImageUpload(e) {
      // Logic moved to workbench
    }
 
    function getFilteredImages() { if (!searchQuery) return images; return images.filter(img => img.name.toLowerCase().includes(searchQuery)); }
    function formatDate(dateString) { const date = new Date(dateString); return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }); }
     
    function updateStats() { 
        const statImages = document.getElementById('stat-images');
        const previewCount = document.getElementById('preview-count');
        if(statImages) statImages.textContent = images.length; 
        if(previewCount) previewCount.textContent = images.length; 
    }
 
    function updateBulkUI() {
        const bulkActions = document.getElementById('bulk-actions');
        const clearAllBtn = document.getElementById('clear-all-btn');
        const selectAllCheckbox = document.getElementById('select-all-checkbox');
        const selectedCountDisplay = document.getElementById('selected-count-display');
 
        const count = selectedImageIds.size;
        if(selectedCountDisplay) selectedCountDisplay.textContent = count;
        if (count > 0) {
           if(bulkActions) bulkActions.classList.remove('hidden');
           if(clearAllBtn) clearAllBtn.classList.add('hidden'); 
        } else {
           if(bulkActions) bulkActions.classList.add('hidden');
           if(clearAllBtn) clearAllBtn.classList.remove('hidden');
           if(selectAllCheckbox) selectAllCheckbox.checked = false;
        }
    }
 
    window.toggleSelection = function(id) {
        const strId = String(id);
        if (selectedImageIds.has(strId)) { selectedImageIds.delete(strId); } else { selectedImageIds.add(strId); }
        renderGallery(); updateBulkUI();
    };
 
    window.deselectAll = function() {
        selectedImageIds.clear();
        renderGallery();
        updateBulkUI();
    };
 
    window.viewImage = function(id) {
        const img = images.find(img => String(img.id) === String(id));
        
        // UNLOCKED: Everyone can view images now
        if(img) {
            // Log history
            if(isLoggedIn) addToHistory(img);
 
            lightboxImg.src = img.src;
            lightbox.classList.remove('hidden');
            setTimeout(() => {
                lightbox.classList.remove('opacity-0');
                lightboxImg.classList.remove('scale-95');
                lightboxImg.classList.add('scale-100');
            }, 10);
        }
    }
 
    window.closeLightbox = function() {
        lightbox.classList.add('opacity-0');
        lightboxImg.classList.remove('scale-100');
        lightboxImg.classList.add('scale-95');
        setTimeout(() => {
            lightbox.classList.add('hidden');
            lightboxImg.src = '';
        }, 300);
    }
 
    window.deleteImage = function(id) {
        if(confirm('Are you sure you want to delete this image?')) {
            const targetId = String(id);
            images = images.filter(img => String(img.id) !== targetId);
            selectedImageIds.delete(targetId);
            renderGallery(); updateStats(); updateBulkUI();
        }
    };
 
    window.clearAllImages = function() {
        if(images.length === 0) return alert("No images to clear!");
        if(confirm('Are you sure you want to delete ALL images? This action cannot be undone.')) {
            images = []; selectedImageIds.clear(); renderGallery(); updateStats(); updateBulkUI();
        }
    };
 
    window.editImageName = function(id) {
        const img = images.find(img => String(img.id) === String(id));
        if(img) {
            const newName = prompt("Enter new name for the image:", img.name);
            if(newName && newName.trim() !== "") { img.name = newName.trim(); renderGallery(); }
        }
    };
 
    window.toggleLike = function(id) {
        const img = images.find(img => String(img.id) === String(id));
        if(img) {
           if(img.isLiked) { img.likes--; img.isLiked = false; } else { img.likes++; img.isLiked = true; }
           renderGallery();
        }
    };
 
    // --- PAGINATION FUNCTIONS ---
    function renderPagination(totalPages) {
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      const pageNumbers = document.getElementById('page-numbers');
 
      if(prevBtn) prevBtn.disabled = currentPage === 1;
      if(nextBtn) nextBtn.disabled = currentPage === totalPages;
 
      let pages = [];
      if (totalPages <= 5) {
        pages = Array.from({ length: totalPages }, (_, i) => i + 1);
      } else {
        if (currentPage <= 3) {
          pages = [1, 2, 3, '...', totalPages];
        } else if (currentPage >= totalPages - 2) {
          pages = [1, '...', totalPages - 2, totalPages - 1, totalPages];
        } else {
          pages = [1, '...', currentPage, '...', totalPages];
        }
      }
 
      if(pageNumbers) {
         pageNumbers.innerHTML = pages.map(page => {
            if (page === '...') {
              return `<span class="w-10 h-10 flex items-center justify-center text-white/40">...</span>`;
            }
            const isActive = page === currentPage;
            return `
              <button 
                class="pagination-btn w-10 h-10 rounded-xl flex items-center justify-center ${isActive ? 'glass bg-white/20' : 'glass-dark'} min-h-[44px] min-w-[44px]"
                onclick="goToPage(${page})"
              >
                ${page}
              </button>
            `;
          }).join('');
      }
    }
 
    window.goToPage = function(page) {
      currentPage = page;
      renderGallery();
      document.getElementById('gallery').scrollIntoView({ behavior: 'smooth' });
    }
 
    function renderGallery() {
        const galleryGrid = document.getElementById('gallery-grid');
        const emptyState = document.getElementById('empty-state');
        const pagination = document.getElementById('pagination');
        const selectAllCheckbox = document.getElementById('select-all-checkbox');
 
        if (!galleryGrid || !emptyState) return;
 
        const filtered = getFilteredImages();
        
        // 1. Calculate Pagination
        const totalPages = Math.ceil(filtered.length / imagesPerPage);
        
        // Safety check for current page
        if (currentPage > totalPages && totalPages > 0) currentPage = totalPages;
        if (currentPage < 1) currentPage = 1;
 
        // 2. Slice Images for Current Page
        const startIndex = (currentPage - 1) * imagesPerPage;
        const endIndex = startIndex + imagesPerPage;
        const pageImages = filtered.slice(startIndex, endIndex);
 
        // 3. Sync Checkbox
        if(selectAllCheckbox && filtered.length > 0) { selectAllCheckbox.checked = filtered.every(img => selectedImageIds.has(String(img.id))); }
        
        // 4. Handle Empty State
        if (filtered.length === 0) { 
           galleryGrid.innerHTML = ''; 
           emptyState.classList.remove('hidden'); 
           if(pagination) pagination.classList.add('hidden');
           return; 
        }
        emptyState.classList.add('hidden');
        
        // 5. Render Grid
        galleryGrid.innerHTML = pageImages.map((img, index) => {
            const isSelected = selectedImageIds.has(String(img.id));
            
            // Mock Author if missing
            const author = img.author || { name: 'Unknown', id: 'unknown', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Unknown' };
            const isFollowing = followedUsers.has(author.id);
 
            return `
            <div class="gallery-card glass rounded-2xl overflow-hidden fade-in relative group ${isSelected ? 'ring-2 ring-blue-500 bg-blue-500/10' : ''}" style="animation-delay: ${index * 0.05}s">
                <div class="absolute top-3 left-3 z-30 transform transition-transform ${isSelected ? 'scale-100' : 'scale-90 opacity-0 group-hover:opacity-100'}">
                    <input type="checkbox" class="w-5 h-5 rounded border-white/40 text-blue-500 focus:ring-offset-0 focus:ring-blue-500 bg-black/40 cursor-pointer backdrop-blur-sm" ${isSelected ? 'checked' : ''} onclick="event.stopPropagation(); toggleSelection('${img.id}')">
                </div>
                <div class="relative aspect-square overflow-hidden cursor-pointer" onclick="viewImage('${img.id}')">
                    <img src="${img.src}" alt="${img.name}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110 ${isSelected ? 'scale-95' : ''}" loading="lazy">
                    
                    <div class="absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity z-20">
                        <button onclick="event.stopPropagation(); downloadImage('${img.id}')" class="p-2 bg-black/50 hover:bg-blue-500/80 rounded-full text-white backdrop-blur-sm transition-colors" title="Download">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                        </button>
                        <button onclick="event.stopPropagation(); deleteImage('${img.id}')" class="p-2 bg-black/50 hover:bg-red-500/80 rounded-full text-white backdrop-blur-sm transition-colors" title="Delete">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>
                    </div>
 
                    <div class="card-overlay absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent flex flex-col justify-end p-4 pointer-events-none">
                        <div class="flex items-center justify-between mb-2 pointer-events-auto">
                            <div class="flex items-center gap-2 truncate flex-1 min-w-0">
                                 <h3 class="font-semibold text-sm truncate text-white" title="${img.name}">${img.name}</h3>
                                 <button onclick="event.stopPropagation(); editImageName('${img.id}')" class="text-white/60 hover:text-white transition-colors flex-shrink-0" title="Edit Name"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg></button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between mb-2 pointer-events-auto">
                            <div class="flex items-center gap-2" title="Published by ${author.name}">
                                 <img src="${author.avatar}" class="w-5 h-5 rounded-full border border-white/30">
                                 <span class="text-xs text-white/80 font-medium truncate max-w-[80px]">${author.name}</span>
                            </div>
                            <button onclick="event.stopPropagation(); toggleFollow('${author.id}', '${author.name}')" class="text-[10px] font-bold px-2 py-0.5 rounded-md transition-colors ${isFollowing ? 'bg-green-500/20 text-green-300 hover:bg-green-500/30' : 'bg-blue-500/20 text-blue-300 hover:bg-blue-500/30'}">
                                 ${isFollowing ? 'Following' : '+ Follow'}
                            </button>
                        </div>
 
                        <div class="flex items-center justify-between pointer-events-auto border-t border-white/10 pt-2">
                            <p class="text-white/50 text-xs">${formatDate(img.uploadedAt)}</p>
                            <button onclick="event.stopPropagation(); toggleLike('${img.id}')" class="flex items-center gap-1.5 group/like bg-white/10 hover:bg-white/20 px-2 py-1 rounded-full transition-colors">
                                 <svg class="w-4 h-4 transition-transform ${img.isLiked ? 'text-red-500 fill-red-500 scale-110' : 'text-white/70 group-hover/like:text-red-400 group-hover/like:scale-110'}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                                 <span class="text-xs font-medium text-white/90">${img.likes || 0}</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>`;
        }).join('');
 
        // 6. Render Pagination UI
        if (totalPages > 1) {
           if(pagination) pagination.classList.remove('hidden');
           renderPagination(totalPages);
        } else {
           if(pagination) pagination.classList.add('hidden');
        }
    }
 
    // Toggle Tabs
    const viewBtn = document.getElementById('view-btn');
    const customizeBtn = document.getElementById('customize-btn');
    const viewMode = document.getElementById('view-mode');
    const customizeMode = document.getElementById('customize-mode');
    if(viewBtn) viewBtn.addEventListener('click', () => { if(!isLoggedIn) return; viewMode.classList.remove('hidden'); customizeMode.classList.add('hidden'); viewBtn.classList.add('active'); customizeBtn.classList.remove('active'); });
    if(customizeBtn) customizeBtn.addEventListener('click', () => { if(!isLoggedIn) return; customizeMode.classList.remove('hidden'); viewMode.classList.add('hidden'); customizeBtn.classList.add('active'); viewBtn.classList.remove('active'); });
 
    // ==================== SOCIAL HUB LOGIC ====================
    // ELEMENTS
    const commentsDrawer = document.getElementById("comments-drawer");
    const commentsOverlay = document.getElementById("comments-overlay");
    const commentsToggleBtn = document.getElementById("comments-toggle-btn");
    const closeCommentsBtn = document.getElementById("close-comments-btn");

    const tabCommunity = document.getElementById("tab-community");
    const tabAi = document.getElementById("tab-ai");
    const viewCommunity = document.getElementById("view-community");
    const viewAi = document.getElementById("view-ai");

    const commentInput = document.getElementById("comment-input");
    const sendCommentBtn = document.getElementById("send-comment-btn");
    const commentsList = document.getElementById("comments-list");

    const aiInput = document.getElementById("ai-input");
    const aiChatList = document.getElementById("ai-chat-list");

    // OPEN CLOSE
    function openComments() { 
        commentsOverlay.classList.remove('hidden'); 
        setTimeout(() => { 
            commentsOverlay.classList.remove('opacity-0'); 
            commentsDrawer.classList.remove('translate-x-full'); 
        }, 10); 
    }
    
    function closeComments() { 
        commentsOverlay.classList.add('opacity-0'); 
        commentsDrawer.classList.add('translate-x-full'); 
        setTimeout(() => commentsOverlay.classList.add('hidden'), 500); // Updated timing for smoother close
    }

    if(commentsToggleBtn) commentsToggleBtn.addEventListener('click', openComments);
    if(closeCommentsBtn) closeCommentsBtn.addEventListener('click', closeComments);
    if(commentsOverlay) commentsOverlay.addEventListener('click', closeComments);

    // --- Tab Switching Logic ---
    if(tabCommunity && tabAi) {
        tabCommunity.onclick = () => {
            viewCommunity.classList.remove("hidden");
            viewAi.classList.add("hidden");
            
            // Update Tab Styles
            tabCommunity.classList.add('bg-white/10', 'text-white');
            tabCommunity.classList.remove('bg-transparent', 'text-white/60');
            
            tabAi.classList.add('bg-transparent', 'text-white/60');
            tabAi.classList.remove('bg-white/10', 'text-white');
        };

        tabAi.onclick = () => {
            viewAi.classList.remove("hidden");
            viewCommunity.classList.add("hidden");
            
            // Update Tab Styles
            tabAi.classList.add('bg-white/10', 'text-white');
            tabAi.classList.remove('bg-transparent', 'text-white/60');
            
            tabCommunity.classList.add('bg-transparent', 'text-white/60');
            tabCommunity.classList.remove('bg-white/10', 'text-white');
        };
    }

    window.switchDrawerTab = function(tab) {
        if (tab === 'community') {
           if(tabCommunity) tabCommunity.click();
        } else {
           if(tabAi) tabAi.click();
        }
    };

    // LOCAL STORAGE COMMENTS
    let localComments = JSON.parse(localStorage.getItem("chat_comments") || "[]");
    // Seed if empty
    if(localComments.length === 0) {
        localComments.push({ author: 'Avanode Team', text: 'Welcome to the Social Hub! Connect with creators here.' });
    }

    function renderComments() {
      if(!commentsList) return;
      commentsList.innerHTML="";
      localComments.forEach(c=>{
        // Use consistent styling with AI chat for better look
        const isSystem = c.author === 'Avanode Team';
        commentsList.innerHTML += `
          <div class="animate-in fade-in slide-in-from-bottom-2 duration-300">
            <div class="flex items-baseline gap-2 mb-1">
                <span class="font-bold text-xs ${isSystem ? 'text-purple-400' : 'text-blue-400'}">${c.author}</span>
                <span class="text-[10px] text-white/30">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
            </div>
            <div class="bg-white/5 rounded-xl rounded-tl-none p-3 text-sm text-white/90 border border-white/5 leading-relaxed">
                ${c.text}
            </div>
          </div>`;
      });
      commentsList.scrollTop = commentsList.scrollHeight;
    }

    renderComments();

    if(sendCommentBtn) {
        sendCommentBtn.onclick = ()=>{
          const text = commentInput.value.trim();
          if(!text) return;

          localComments.push({
            author: currentUsername || "Guest",
            text
          });

          localStorage.setItem("chat_comments", JSON.stringify(localComments));
          commentInput.value="";
          renderComments();
        };
    }

    // AI CHAT FUNCTION (Using Fetch for Real AI)
    const apiKey = ""; // The execution environment provides the key at runtime.
    
    // System Instruction for the AI about the website
    const systemPrompt = `
    You are the AI Assistant for Avanode Digitals, a digital animation arts website founded by Rohit Phogat (est. 2026).
    Key Sections:
    1. Profile: Hero section with 3D mascot.
    2. Gallery: Multimedia gallery for Digital Art, VFX, Motion Graphics.
    3. Subscriptions: Explorer (Free), Creator ($19/mo).
    4. About: Information about the company and founder.
    5. Social Group (Contact): Links to LinkedIn, GitHub, WhatsApp, Twitter.
    6. Support: Ticket system, Live Chat, Knowledge Base.
    7. Settings: Dark mode, Language, Account switching.

    Your goal is to help users navigate the site, explain features, and provide info about digital arts.
    If asked about the 'Chat Community', explain it's the Social Hub where creators connect.
    Always be helpful, concise, and friendly.
    `;

    let chatHistory = [
        { role: "user", parts: [{ text: "Hello" }] },
        { role: "model", parts: [{ text: "Hello! Welcome to Avanode Digitals. How can I help you today?" }] }
    ];

    window.sendAiMessage = async function(){
      const msg = aiInput.value.trim();
      if(!msg) return;

      // User Message UI
      aiChatList.innerHTML += `
        <div class="flex flex-col items-end animate-in fade-in slide-in-from-bottom-2">
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl rounded-tr-none p-3 text-sm text-white max-w-[85%] shadow-lg">
                ${msg}
            </div>
        </div>`;
      
      aiInput.value="";
      aiChatList.scrollTop = aiChatList.scrollHeight;

      // Add to History
      chatHistory.push({ role: "user", parts: [{ text: msg }] });

      // AI Typing Indicator
      const typingId = 'typing-' + Date.now();
      aiChatList.innerHTML += `
        <div id="${typingId}" class="flex items-center gap-2 mt-2">
            <div class="w-6 h-6 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-[10px]">ü§ñ</div>
            <div class="text-white/40 text-xs italic animate-pulse">thinking...</div>
        </div>`;
      aiChatList.scrollTop = aiChatList.scrollHeight;

      try {
          let replyText = "";
          
          if (!apiKey) {
              // FALLBACK SIMULATION IF NO API KEY (Local Environment)
              await new Promise(r => setTimeout(r, 1000));
              const t = msg.toLowerCase();
              if(t.includes("hello")) replyText="Hello! üëã Welcome to Avanode Digitals. How can I assist you today?";
              else if(t.includes("upload")) replyText="To upload artwork, please use the 'Upload' button in the Gallery section. Make sure you are logged in!";
              else if(t.includes("delete")) replyText="You can remove images by selecting them and clicking the trash icon in the toolbar.";
              else if(t.includes("help")) replyText="I can help you navigate the site, explain features, or provide info about our subscription tiers.";
              else if(t.includes("who")) replyText="I am Avanode AI, your virtual assistant for all things digital art and animation. ü§ñ";
              else if(t.includes("price") || t.includes("cost")) replyText="We offer a Free Explorer tier and a Creator tier at $19/mo. Check the Subscription section for more details.";
              else replyText = "I'm currently in offline mode. Please check the gallery or support section for more info!";
          } else {
              // REAL API CALL
              const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                      contents: chatHistory,
                      systemInstruction: { parts: [{ text: systemPrompt }] }
                  })
              });

              if (!response.ok) throw new Error('API Error');
              const data = await response.json();
              replyText = data.candidates?.[0]?.content?.parts?.[0]?.text || "I couldn't process that.";
          }

          // Remove Typing Indicator
          const typingEl = document.getElementById(typingId);
          if(typingEl) typingEl.remove();

          // Add to History
          chatHistory.push({ role: "model", parts: [{ text: replyText }] });

          // AI Message UI
          aiChatList.innerHTML += `
            <div class="flex flex-col items-start animate-in fade-in slide-in-from-bottom-2">
                <div class="flex items-center gap-2 mb-1 pl-1">
                    <div class="w-4 h-4 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-[8px]">AI</div>
                    <span class="text-[10px] text-white/40">Avanode Bot</span>
                </div>
                <div class="bg-white/10 border border-white/10 rounded-2xl rounded-tl-none p-3 text-sm text-white/90 max-w-[90%] shadow-sm">
                    ${replyText}
                </div>
            </div>`;
          aiChatList.scrollTop = aiChatList.scrollHeight;

      } catch (error) {
          console.error(error);
          const typingEl = document.getElementById(typingId);
          if(typingEl) typingEl.remove();
          
          aiChatList.innerHTML += `
            <div class="flex flex-col items-start animate-in fade-in slide-in-from-bottom-2">
                <div class="bg-red-500/20 border border-red-500/30 rounded-2xl rounded-tl-none p-3 text-sm text-red-200 max-w-[90%]">
                    Sorry, I encountered an error connecting to the AI server.
                </div>
            </div>`;
      }
    }

    // Allow Enter key to send
    if(aiInput) aiInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') sendAiMessage(); });
    if(commentInput) commentInput.addEventListener('keypress', (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if(sendCommentBtn) sendCommentBtn.click(); } });
 
    // Scroll to Top Logic
    const scrollTopBtn = document.getElementById('scroll-top-btn');
    if(scrollTopBtn) {
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                scrollTopBtn.classList.remove('opacity-0', 'pointer-events-none', 'translate-y-4');
            } else {
                scrollTopBtn.classList.add('opacity-0', 'pointer-events-none', 'translate-y-4');
            }
        });
    }
 
  </script>
 </body>
</html>
